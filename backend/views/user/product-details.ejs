<!DOCTYPE html>
<html lang="en">


<meta http-equiv="content-type" content="text/html;charset=UTF-8" />

<head>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-KTMNTPV3');</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <title>Hofmaan | Product Details</title>
    <meta name="keywords" content="Hofmaan" />
    <meta name="description" content="Hofmaan">
    <meta name="author" content="Trivlogic">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/images/logo-2.png">

    <!-- WebFont.js -->
    <script>
        WebFontConfig = {
            google: { families: ['Poppins:400,500,600,700'] }
        };
        (function (d) {
            var wf = d.createElement('script'), s = d.scripts[0];
            wf.src = '/js/webfont.js';
            wf.async = true;
            s.parentNode.insertBefore(wf, s);
        })(document);
    </script>

    <link rel="preload" href="/vendor/fontawesome-free/webfonts/fa-regular-400.woff2" as="font" type="font/woff2"
        crossorigin="anonymous">
    <link rel="preload" href="/vendor/fontawesome-free/webfonts/fa-solid-900.woff2" as="font" type="font/woff2"
        crossorigin="anonymous">
    <link rel="preload" href="/vendor/fontawesome-free/webfonts/fa-brands-400.woff2" as="font" type="font/woff2"
        crossorigin="anonymous">
    <link rel="preload" href="/fonts/wolmart87d5.woff?png09e" as="font" type="font/woff" crossorigin="anonymous">

    <!-- Vendor CSS -->
    <link rel="stylesheet" type="text/css" href="/vendor/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/vendor/animate/animate.min.css">

    <!-- Plugin CSS -->
    <link rel="stylesheet" type="text/css" href="/vendor/magnific-popup/magnific-popup.min.css">
    <link rel="stylesheet" href="/vendor/swiper/swiper-bundle.min.css">
    <link rel="stylesheet" type="text/css" href="/vendor/photoswipe/photoswipe.min.css">
    <link rel="stylesheet" type="text/css" href="/vendor/photoswipe/default-skin/default-skin.min.css">
    <!-- Swiper's CSS -->
    <link rel="stylesheet" href="/vendor/swiper/swiper-bundle.min.css">

    <!-- Default CSS -->
    <link rel="stylesheet" type="text/css" href="/css/style.min.css">
    <!-- Add this in your <head> or before your script tag -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
        .variant-label {
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 14px;
        }

        .color-options-container,
        .size-options-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
        }

        .color-option {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .color-option.selected {
            border-color: #333;
            transform: scale(1.1);
        }

        .size-option {
            padding: 3px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .size-option.selected {
            background-color: #333;
            color: white;
            border-color: #333;
        }
    </style>
</head>

<body>
    <div class="page-wrapper">
        <!-- Start of Header -->
        <header class="header">
            <div class="header-top">
                <div class="container">
                    <div class="header-left">
                        <p class="welcome-msg">Welcome to Hofmaan Store! Offers Available</p>
                    </div>
                    <div class="header-right">
                        <span class="divider d-lg-show"></span>
                        <a href="/store" class="d-lg-show">Store</a>
                        <a href="/about" class="d-lg-show">About Us</a>
                        <a href="/contact" class="d-lg-show">Contact Us</a>
                        <% if (user) { %>
                            <a href="/account" class="d-lg-show"><i class="w-icon-account"></i>Profile</a>
                            <span class="delimiter d-lg-show">/</span>
                            <a href="/orders" class="ml-0 d-lg-show">My Orders</a>
                            <% } else { %>
                                <a href="/auth/login" class="d-lg-show"><i class="w-icon-account"></i>Sign In</a>
                                <span class="delimiter d-lg-show">/</span>
                                <a href="/auth/login" class="ml-0 d-lg-show">Register</a>
                                <% } %>
                    </div>
                </div>
            </div>
            <!-- End of Header Top -->
            <div class="header-middle sticky-content fix-top sticky-header border-no">
                <div class="container">
                    <div class="header-left mr-md-4">
                        <a href="#" class="mobile-menu-toggle  w-icon-hamburger"></a>
                        <a href="/" class="logo">
                            <img src="/images/logo.png" alt="logo" width="200">
                        </a>
                        <form class="input-wrapper header-search hs-expanded hs-round d-none d-md-flex" id="searchForm"
                            style="position:relative;">
                            <div class="custom-search-bar w-100">
                                <input type="text" class="form-control" name="q" id="searchInput"
                                    placeholder="Search for products..." autocomplete="off" />
                                <button class="btn btn-search" type="submit" aria-label="Search">
                                    <i class="w-icon-search"></i>
                                </button>
                            </div>
                            <div id="searchSuggestions" class="search-suggestions"></div>
                        </form>
                        <div id="searchResults" class="search-results-container"></div>
                    </div>
                    <div class="header-right ml-4">
                        <div class="header-call d-xs-show d-lg-flex align-items-center">
                            <a href="tel:+919400947122" class="w-icon-call"></a>
                            <div class="call-info d-lg-show">
                                <h4 class="chat font-size-md text-normal ls-normal text-white mb-0">
                                    <a href="tel:+919400947122"
                                        class="text-capitalize text-primary font-weight-normal">Customer care</a>
                                </h4>
                                <a href="tel:+919400947122" class="phone-number font-weight-bolder ls-50">+91
                                    9400947122</a>
                            </div>
                        </div>
                        <a class="wishlist label-down link d-xs-show" href="/wishlist">
                            <i class="w-icon-heart"></i>
                            <span class="wishlist-label d-lg-show">Wishlist</span>
                        </a>
                        <div class="dropdown cart-dropdown cart-offcanvas mr-0 mr-lg-2">
                            <div class="cart-overlay"></div>
                            <a href="/cart" class=" label-down link">
                                <i class="w-icon-cart">
                                    <span class="cart-count text-white">+</span>
                                </i>
                                <span class="cart-label">Cart</span>
                            </a>

                            <!-- End of Dropdown Box -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- End of Header Middle -->
        </header>
        <!-- End of Header -->


        <!-- Start of Main -->
        <main class="main mb-10 pb-1">
            <!-- Start of Breadcrumb -->
            <nav class="breadcrumb-nav container">
                <ul class="breadcrumb bb-no">
                    <li><a href="/">Home</a></li>
                    <li>Products</li>
                </ul>

            </nav>
            <!-- End of Breadcrumb -->

            <!-- Start of Page Content -->
            <div class="page-content">
                <div class="container">
                    <div class="row gutter-lg">
                        <div class="main-content">
                            <style>
                                .size-swatch--out-of-stock {
                                    position: relative;
                                    pointer-events: none;
                                    opacity: 0.5;
                                    cursor: not-allowed;
                                }
                                .size-swatch--out-of-stock .cross-mark {
                                    position: absolute;
                                    left: 50%;
                                    top: 50%;
                                    transform: translate(-50%, -50%) rotate(-45deg);
                                    width: 80%;
                                    height: 2px;
                                    background: #e74c3c;
                                    z-index: 2;
                                    border-radius: 2px;
                                }
                                .size-swatch--out-of-stock .cross-mark-2 {
                                    position: absolute;
                                    left: 50%;
                                    top: 50%;
                                    transform: translate(-50%, -50%) rotate(45deg);
                                    width: 80%;
                                    height: 2px;
                                    background: #e74c3c;
                                    z-index: 2;
                                    border-radius: 2px;
                                }
                                .size-swatch--out-of-stock {
                                    color: #aaa !important;
                                    background: #f8d7da !important;
                                }
                                .size-swatch--out-of-stock span {
                                    z-index: 3;
                                    position: relative;
                                }
                            </style>
                            <% 
                                // Calculate discount percentage if applicable
                                let discountPercent = null;
                                if (product.salePrice && product.basePrice && product.salePrice < product.basePrice) {
                                    discountPercent = Math.round(((product.basePrice - product.salePrice) / product.basePrice) * 100);
                                }
                            %>
                            <div class="product product-single row">
                                <div class="col-md-6 mb-6">
                                    <div class="product-gallery product-gallery-sticky">
                                        <div class="swiper-container product-single-swiper swiper-theme nav-inner">
                                            <div class="swiper-wrapper row cols-1 gutter-no" id="main-product-images">
                                                <% let imagesToShow=(product.images && product.images.length) ?
                                                    product.images : ['/images/hofmaan/sampleimage.jpg']; %>
                                                    <% imagesToShow.forEach(function(img, idx) { %>
                                                        <div class="swiper-slide">
                                                            <figure class="product-image">
                                                                <img  src="<%= img %>" data-zoom-image="<%= img %>"
                                                                    alt="<%= product.name %> Image <%= idx+1 %>"
                                                                    width="800" height="900">
                                                            </figure>
                                                        </div>
                                                        <% }) %>
                                            </div>
                                        </div>
                                        <div class="product-thumbs-wrap swiper-container" data-swiper-options="{
                                            'navigation': {
                                                'nextEl': '.swiper-button-next',
                                                'prevEl': '.swiper-button-prev'
                                            }
                                        }">
                                            <div class="product-thumbs swiper-wrapper row cols-4 gutter-sm"
                                                id="product-thumbs">
                                                <% imagesToShow.forEach(function(img, idx) { %>
                                                    <div class="product-thumb swiper-slide">
                                                        <img src="<%= img %>" alt="Product Thumb <%= idx+1 %>"
                                                            width="100" height="110">
                                                    </div>
                                                    <% }) %>
                                            </div>
                                            <button class="swiper-button-next"></button>
                                            <button class="swiper-button-prev"></button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-4 mb-md-6">
                                    <div class="product-details" data-sticky-options="{'minWidth': 767}">
                                        <h1 class="product-title text-uppercase">
                                            <%= product.name %>
                                        </h1>
                                        <div class="product-bm-wrapper">
                                            <figure class="brand">
                                                <img src="<%= product.brandImage || '/images/hofmaan/blackDuck.jpg' %>"
                                                    alt="Brand" width="102" height="48" />
                                            </figure>
                                        </div>
                                        <div class="product-meta">
                                            <div class="product-categories">
                                                Category:
                                                <span class="product-category">
                                                    <a href="#">
                                                        <%= category ? category.name : 'N/A' %>
                                                    </a>
                                                </span>
                                            </div>
                                            <% if (product.subcategory) { %>
                                                <div class="product-sku">
                                                    Subcategory: <span>
                                                        <% let subcategoryName='-' ; if (product.category &&
                                                            product.category.subCategories && product.subcategory) {
                                                            const
                                                            foundSub=product.category.subCategories.find(function(sub) {
                                                            return (sub._id && sub._id.toString &&
                                                            sub._id.toString()===product.subcategory.toString()) ||
                                                            (sub._id==product.subcategory); }); if (foundSub &&
                                                            foundSub.name) { subcategoryName=foundSub.name; } } %>
                                                            <%= subcategoryName %>
                                                    </span>
                                                </div>
                                                <% } %>
                                        </div>
                                        <hr class="product-divider">

                                        <div class="product-price d-flex align-items-center" style="gap: 12px;">
                                            <% if (product.salePrice && product.salePrice < product.basePrice) { %>
                                                <del class="old-price mr-2">₹ <%= product.basePrice %>
                                                </del>
                                                <ins class="new-price ">₹ <%= product.salePrice %>
                                                </ins>
                                                <% if (discountPercent) { %>
                                                    <span class="" style="
                                                        background: linear-gradient(90deg, #ff512f 0%, #dd2476 100%);
                                                        color: #fff;
                                                        font-weight: bold;
                                                        border-radius: 20px;
                                                        padding: 6px 16px;
                                                        font-size: 1.1rem;
                                                        margin-left: 8px;
                                                        box-shadow: 0 2px 8px rgba(221,36,118,0.15);
                                                        letter-spacing: 1px;
                                                        animation: pop-discount 1s cubic-bezier(.36,1.64,.7,.98) 1;
                                                    ">
                                                        <i class="w-icon-sale" style="margin-right: 4px;"></i>
                                                        <%= discountPercent %>% OFF
                                                    </span>
                                                    <style>
                                                        @keyframes pop-discount {
                                                            0% { transform: scale(0.7); opacity: 0.2; }
                                                            60% { transform: scale(1.15); opacity: 1; }
                                                            100% { transform: scale(1); }
                                                        }
                                                        .discount-badge {
                                                            display: inline-flex;
                                                            align-items: center;
                                                            box-shadow: 0 2px 8px rgba(221,36,118,0.15);
                                                        }
                                                    </style>
                                                <% } %>
                                            <% } else { %>
                                                <ins class="new-price">₹ <%= product.basePrice %>
                                                </ins>
                                            <% } %>
                                        </div>

                                        <% if (discountPercent) { %>
                                            <div class="catchy-discount-text" style="
                                                margin-top: 10px;
                                                font-size: 1.15rem;
                                                color: #e74c3c;
                                                font-weight: 600;
                                                letter-spacing: 0.5px;
                                                text-shadow: 0 1px 6px #ffeaea;
                                                display: flex;
                                                align-items: center;
                                                gap: 6px;
                                            ">
                                                <i class="w-icon-fire" style="color: #ff512f; font-size: 1.3em;"></i>
                                                <span>Hurry! <%= discountPercent %>% OFF for a limited time!</span>
                                            </div>
                                        <% } %>

                                        <div class="product-short-desc">
                                            <% if (product.description) { %>
                                                <p>
                                                    <%= product.description %>
                                                </p>
                                                <% } %>
                                        </div>

                                        <hr class="product-divider">

                                        <% if (product.hasColorVariants && product.colorVariants &&
                                            product.colorVariants.length) { %>
                                            <div class="product-form product-variation-form product-color-swatch">
                                                <div class="d-flex align-items-center mb-2" style="gap: 10px;">
                                                    <label style="margin-bottom:0;">Color:</label>
                                                    <a href="#" class="product-variation-clean" id="reset-color"
                                                        style="display: none;">Reset</a>
                                                </div>
                                                <div class="d-flex align-items-center product-variations"
                                                    id="color-options">
                                                    <% product.colorVariants.forEach(function(variant, index) { %>
                                                        <a href="#"
                                                            class="color color-swatch <%= index === 0 ? 'color-swatch--selected' : '' %>"
                                                            style="background-color: <%= variant.color || '#ccc' %>"
                                                            data-color="<%= variant.color %>"
                                                            data-image="<%= variant.image || '' %>"
                                                            data-variant-id="<%= variant._id %>">
                                                        </a>
                                                        <% }) %>
                                                </div>
                                            </div>
                                            <% } %>

                                                <% if (product.hasSizeVariants && product.sizeVariants &&
                                                    product.sizeVariants.length) { %>
                                                    <div
                                                        class="product-form product-variation-form product-size-swatch">
                                                        <div class="d-flex align-items-center mb-2" style="gap: 10px;">
                                                            <label class="mb-1">Size:</label>
                                                            <a href="#" class="product-variation-clean" id="reset-size"
                                                                style="display: none;">Clear</a>
                                                        </div>
                                                        <div class="flex-wrap d-flex align-items-center product-variations"
                                                            id="size-options">
                                                            <% product.sizeVariants.forEach(function(variant, index) {
                                                                const outOfStock = (typeof variant.stock !== 'undefined' && variant.stock === 0);
                                                            %>
                                                                <a href="#"
                                                                    class="size size-swatch <%= index === 0 && !outOfStock ? 'size-swatch--selected' : '' %> <%= outOfStock ? 'size-swatch--out-of-stock' : '' %>"
                                                                    data-size="<%= variant.size %>"
                                                                    data-variant-id="<%= variant._id %>"
                                                                    <%= outOfStock ? 'tabindex="-1" aria-disabled="true"' : '' %>
                                                                    style="position: relative; user-select: none;">
                                                                    <span><%= variant.size %></span>
                                                                    <% if (outOfStock) { %>
                                                                        <span class="cross-mark"></span>
                                                                        <span class="cross-mark-2"></span>
                                                                    <% } %>
                                                                </a>
                                                            <% }) %>
                                                        </div>
                                                    </div>
                                                    <% } %>



                                                        <div class="fix-bottom product-sticky-content sticky-content">
                                                            <div
                                                                class="product-form container details-qty d-flex justify-content-start align-items-center ">
                                                                <div class="product-qty-form details-qty">
                                                                    <div class="input-group mt-2">
                                                                        <input class="product-quantity-input form-control"
                                                                            type="number" min="1" max="10000000"
                                                                            value="1">
                                                                        <button
                                                                            class="product-quantity-plus w-icon-plus"></button>
                                                                        <button
                                                                            class="product-quantity-minus w-icon-minus"></button>
                                                                    </div>
                                                                </div>
                                                                <button
                                                                    class="btn btn-primary stick-btn details-btn main-btn btn-cart-new">
                                                                    <i class="w-icon-cart"></i>
                                                                    <span>Add to Cart</span>
                                                                </button>
                                                            </div>
                                                        </div>
                                    </div>
                                </div>
                            </div>

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    // Product data from server
                                    const productData = {
                                        id: '<%= product._id %>',
                                        name: '<%= product.name %>',
                                        image: '<%= product.images && product.images[0] ? product.images[0] : "/images/placeholder-product.jpg" %>',
                                        price: <%= product.salePrice || product.basePrice %>,
                                        hasColor: <%= product.hasColorVariants ? 'true' : 'false' %>,
                                        hasSize: <%= product.hasSizeVariants ? 'true' : 'false' %>,
                                        sizeVariants: <%- JSON.stringify(product.sizeVariants || []) %>
                                    };

                                    // Selected variants tracking
                                    let selectedVariants = {
                                        color: null,
                                        size: null,
                                        colorVariantId: null
                                    };

                                    // DOM elements with new class names
                                    const quantityInput = document.querySelector('.product-quantity-input');
                                    const addToCartBtn = document.querySelector('.btn-cart-new');
                                    const colorOptions = document.querySelectorAll('#color-options .color');
                                    const sizeOptions = document.querySelectorAll('#size-options .size');
                                    const resetColorBtn = document.getElementById('reset-color');
                                    const resetSizeBtn = document.getElementById('reset-size');

                                    // Quantity controls with new class names
                                    const quantityPlus = document.querySelector('.product-quantity-plus');
                                    const quantityMinus = document.querySelector('.product-quantity-minus');

                                    // Remove any existing event listeners by cloning the node (defensive, in case of re-render)
                                    if (quantityPlus) {
                                        const newPlus = quantityPlus.cloneNode(true);
                                        quantityPlus.parentNode.replaceChild(newPlus, quantityPlus);
                                    }
                                    if (quantityMinus) {
                                        const newMinus = quantityMinus.cloneNode(true);
                                        quantityMinus.parentNode.replaceChild(newMinus, quantityMinus);
                                    }
                                    // Re-select after replacement
                                    const plusBtn = document.querySelector('.product-quantity-plus');
                                    const minusBtn = document.querySelector('.product-quantity-minus');

                                    if (plusBtn) {
                                        plusBtn.addEventListener('click', function (e) {
                                            e.preventDefault();
                                            let currentValue = parseInt(quantityInput.value) || 1;
                                            quantityInput.value = currentValue + 1;
                                            quantityInput.dispatchEvent(new Event('change'));
                                        });
                                    }

                                    if (minusBtn) {
                                        minusBtn.addEventListener('click', function (e) {
                                            e.preventDefault();
                                            let currentValue = parseInt(quantityInput.value) || 1;
                                            if (currentValue > 1) {
                                                quantityInput.value = currentValue - 1;
                                                quantityInput.dispatchEvent(new Event('change'));
                                            }
                                        });
                                    }

                                    // Prevent manual input of invalid values
                                    if (quantityInput) {
                                        quantityInput.addEventListener('input', function () {
                                            let val = parseInt(this.value) || 1;
                                            if (val < 1) val = 1;
                                            if (val > 10000000) val = 10000000;
                                            this.value = val;
                                        });
                                    }

                                    // Color selection
                                    colorOptions.forEach(colorOption => {
                                        colorOption.addEventListener('click', function (e) {
                                            e.preventDefault();

                                            // Remove active class from all colors
                                            colorOptions.forEach(c => c.classList.remove('active'));

                                            // Add active class to selected color
                                            this.classList.add('active');

                                            // Update selected variants
                                            selectedVariants.color = this.getAttribute('data-color');
                                            selectedVariants.colorVariantId = this.getAttribute('data-variant-id');

                                            // Show reset button
                                            if (resetColorBtn) {
                                                resetColorBtn.style.display = 'inline';
                                            }

                                            // Update main image if variant has image
                                            const variantImage = this.getAttribute('data-image');
                                            if (variantImage) {
                                                updateMainImage(variantImage);
                                                // Re-initialize zoom after image update
                                                if (window.jQuery && window.Wolmart && window.Wolmart.zoomImageOptions) {
                                                    setTimeout(function() {
                                                        $('.product-image img').trigger('zoom.destroy').zoom(Wolmart.zoomImageOptions);
                                                    }, 100);
                                                }
                                            }
                                        });
                                    });

                                    // Size selection
                                    sizeOptions.forEach(sizeOption => {
                                        // If out of stock, do not allow selection
                                        if (sizeOption.classList.contains('size-swatch--out-of-stock')) {
                                            sizeOption.addEventListener('click', function (e) {
                                                e.preventDefault();
                                                return false;
                                            });
                                            sizeOption.setAttribute('aria-disabled', 'true');
                                            sizeOption.setAttribute('tabindex', '-1');
                                            return;
                                        }
                                        sizeOption.addEventListener('click', function (e) {
                                            e.preventDefault();

                                            // Remove active class from all sizes
                                            sizeOptions.forEach(s => s.classList.remove('active'));

                                            // Add active class to selected size
                                            this.classList.add('active');

                                            // Update selected variants
                                            selectedVariants.size = this.textContent.trim();

                                            // Show reset button
                                            if (resetSizeBtn) {
                                                resetSizeBtn.style.display = 'inline';
                                            }
                                        });
                                    });

                                    // Reset color selection
                                    if (resetColorBtn) {
                                        resetColorBtn.addEventListener('click', function (e) {
                                            e.preventDefault();
                                            colorOptions.forEach(c => c.classList.remove('active'));
                                            selectedVariants.color = null;
                                            selectedVariants.colorVariantId = null;
                                            this.style.display = 'none';
                                        });
                                    }

                                    // Reset size selection
                                    if (resetSizeBtn) {
                                        resetSizeBtn.addEventListener('click', function (e) {
                                            e.preventDefault();
                                            sizeOptions.forEach(s => s.classList.remove('active'));
                                            selectedVariants.size = null;
                                            this.style.display = 'none';
                                        });
                                    }

                                    // Add to Cart functionality
                                    if (addToCartBtn) {
                                        addToCartBtn.addEventListener('click', async function (e) {
                                            e.preventDefault();

                                            // Validate variant selections
                                            if (productData.hasColor && !selectedVariants.color) {
                                                showToast('Please select a color', 'error');
                                                return;
                                            }

                                            if (productData.hasSize && !selectedVariants.size) {
                                                showToast('Please select a size', 'error');
                                                return;
                                            }

                                            // If size is selected, check if out of stock
                                            if (productData.hasSize && selectedVariants.size) {
                                                const selectedSizeObj = productData.sizeVariants.find(
                                                    v => v.size === selectedVariants.size
                                                );
                                                if (selectedSizeObj && selectedSizeObj.stock === 0) {
                                                    showToast('Selected size is out of stock', 'error');
                                                    return;
                                                }
                                            }

                                            const quantity = parseInt(quantityInput.value) || 1;

                                            // Prepare cart item
                                            const cartItem = {
                                                productId: productData.id,
                                                quantity: quantity,
                                                selectedColor: selectedVariants.color,
                                                selectedSize: selectedVariants.size,
                                                productName: productData.name,
                                                productImage: productData.image,
                                                price: productData.price
                                            };

                                            await addToCart(cartItem);
                                        });
                                    }

                                    // Wishlist functionality - Add wishlist button to the page
                                    addWishlistButton();

                                    function updateMainImage(imageUrl) {
                                        const mainImages = document.querySelectorAll('#main-product-images img');
                                        if (mainImages.length > 0 && imageUrl) {
                                            // Update the first main image
                                            mainImages[0].src = imageUrl;
                                            mainImages[0].setAttribute('data-zoom-image', imageUrl);
                                            // Re-initialize zoom after image update
                                            if (window.jQuery && window.Wolmart && window.Wolmart.zoomImageOptions) {
                                                setTimeout(function() {
                                                    $('.product-image img').trigger('zoom.destroy').zoom(Wolmart.zoomImageOptions);
                                                }, 100);
                                            }
                                        }
                                    }

                                    function addWishlistButton() {
                                        // Find a suitable place to add wishlist button (after the add to cart button)
                                        const cartButtonContainer = document.querySelector('.product-form.container');
                                        if (cartButtonContainer) {
                                            const wishlistBtn = document.createElement('button');
                                            wishlistBtn.className = 'btn btn-outline-primary btn-wishlist';
                                            wishlistBtn.innerHTML = '<span>Add to Wishlist</span>';
                                            wishlistBtn.style.marginLeft = '10px';

                                            wishlistBtn.addEventListener('click', function (e) {
                                                e.preventDefault();

                                                // If size is required and selected size is out of stock, block wishlist
                                                if (productData.hasSize && selectedVariants.size) {
                                                    const selectedSizeObj = productData.sizeVariants.find(
                                                        v => v.size === selectedVariants.size
                                                    );
                                                    if (selectedSizeObj && selectedSizeObj.stock === 0) {
                                                        showToast('Selected size is out of stock', 'error');
                                                        return;
                                                    }
                                                }

                                                addToWishlist();
                                            });

                                            cartButtonContainer.appendChild(wishlistBtn);
                                        }
                                    }

                                    async function addToCart(cartItem) {
                                        const isLoggedIn = window.isLoggedIn === true || window.isLoggedIn === 'true';

                                        if (isLoggedIn) {
                                            // User is logged in - send to server
                                            try {
                                                const response = await fetch('/add-cart', {
                                                    method: 'POST',
                                                    headers: {
                                                        'Content-Type': 'application/json'
                                                    },
                                                    credentials: 'include',
                                                    body: JSON.stringify(cartItem)
                                                });

                                                const data = await response.json();

                                                if (data.error) {
                                                    showToast(data.error, 'error');
                                                    return;
                                                }

                                                showToast('Product added to cart successfully!', 'success');

                                            } catch (error) {
                                                console.error('Error adding to cart:', error);
                                                showToast('Error adding product to cart', 'error');
                                            }
                                        } else {
                                            // Guest user - store in localStorage
                                            try {
                                                let guestCart = JSON.parse(localStorage.getItem('guestCart')) || [];

                                                // Check if item already exists with same variants
                                                const existingItemIndex = guestCart.findIndex(item =>
                                                    item.productId === cartItem.productId &&
                                                    item.selectedColor === cartItem.selectedColor &&
                                                    item.selectedSize === cartItem.selectedSize
                                                );

                                                if (existingItemIndex > -1) {
                                                    // Update quantity
                                                    guestCart[existingItemIndex].quantity += cartItem.quantity;
                                                } else {
                                                    // Add new item
                                                    guestCart.push(cartItem);
                                                }

                                                localStorage.setItem('guestCart', JSON.stringify(guestCart));
                                                showToast('Product added to cart successfully!', 'success');

                                            } catch (error) {
                                                console.error('Error adding to guest cart:', error);
                                                showToast('Error adding product to cart', 'error');
                                            }
                                        }
                                    }

                                    async function addToWishlist() {
                                        const isLoggedIn = window.isLoggedIn === true || window.isLoggedIn === 'true';

                                        if (!isLoggedIn) {
                                            showToast('Please login to add items to wishlist', 'error');
                                            return;
                                        }

                                        // Validate variant selections if required
                                        if (productData.hasColor && !selectedVariants.color) {
                                            showToast('Please select a color before adding to wishlist', 'error');
                                            return;
                                        }

                                        if (productData.hasSize && !selectedVariants.size) {
                                            showToast('Please select a size before adding to wishlist', 'error');
                                            return;
                                        }

                                        // If size is selected, check if out of stock
                                        if (productData.hasSize && selectedVariants.size) {
                                            const selectedSizeObj = productData.sizeVariants.find(
                                                v => v.size === selectedVariants.size
                                            );
                                            if (selectedSizeObj && selectedSizeObj.stock === 0) {
                                                showToast('Selected size is out of stock', 'error');
                                                return;
                                            }
                                        }

                                        const wishlistItem = {
                                            productId: productData.id,
                                            ...(selectedVariants.color && { selectedColor: selectedVariants.color }),
                                            ...(selectedVariants.size && { selectedSize: selectedVariants.size })
                                        };

                                        try {
                                            const response = await fetch('/create-wishlist', {
                                                method: 'POST',
                                                headers: {
                                                    'Content-Type': 'application/json'
                                                },
                                                credentials: 'include',
                                                body: JSON.stringify(wishlistItem)
                                            });

                                            const data = await response.json();

                                            if (data && data.success) {
                                                showToast('Product added to wishlist!', 'success');

                                                // Update wishlist button appearance
                                                const wishlistBtn = document.querySelector('.btn-wishlist');
                                                if (wishlistBtn) {
                                                    wishlistBtn.classList.add('active');
                                                    wishlistBtn.innerHTML = '<span>Added to Wishlist</span>';
                                                }
                                            } else {
                                                showToast(data.error || 'Could not add to wishlist', 'error');
                                            }

                                        } catch (error) {
                                            console.error('Error adding to wishlist:', error);
                                            showToast('Error adding to wishlist', 'error');
                                        }
                                    }

                                    function showToast(message, type = 'success') {
                                        Toastify({
                                            text: message,
                                            duration: 3000,
                                            close: true,
                                            gravity: "top",
                                            position: "right",
                                            backgroundColor: type === "success"
                                                ? "linear-gradient(90deg, #00b09b, #96c93d)"
                                                : "linear-gradient(90deg, #e74c3c, #c0392b)",
                                            stopOnFocus: true
                                        }).showToast();
                                    }
                                });
                            </script>

                            <div class="tab tab-nav-boxed tab-nav-underline product-tabs">
                                <ul class="nav nav-tabs" role="tablist">
                                    <li class="nav-item">
                                        <a href="#product-tab-description" class="nav-link active">Description</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="#product-tab-specification" class="nav-link">Product Details</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="#product-tab-reviews" class="nav-link">
                                            Customer Reviews
                                        </a>
                                    </li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="product-tab-description">
                                        <div class="row mb-4">
                                            <div class="col-md-12 mb-5">
                                                <h4 class="title tab-pane-title font-weight-bold mb-2">More Details</h4>
                                                <p class="mb-4">
                                                    <%= product.moreDetails || 'No description available.' %>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="row cols-md-3">
                                            <div class="mb-3">
                                                <h5 class="sub-title font-weight-bold"><span class="mr-3">1.</span>Easy
                                                    Returns</h5>
                                                <p class="detail pl-5">Hassle-Free Returns within 7 Days</p>
                                            </div>
                                            <div class="mb-3">
                                                <h5 class="sub-title font-weight-bold"><span>2.</span>Free Shipping</h5>
                                                <p class="detail pl-5">Free Shipping on Orders Above ₹2999<br>
                                                    This encourages higher cart value and improves conversion.</p>
                                            </div>
                                            <div class="mb-3">
                                                <h5 class="sub-title font-weight-bold"><span>3.</span> Secure Payment
                                                </h5>
                                                <p class="detail pl-5">100% Secure Payments — UPI, Card<br>
                                                    Reassures users that their transactions are safe.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="product-tab-specification">
                                        <ul class="list-none">
                                            <% 
                                                const details = product.productDetails || {};
                                                const detailFields = [
                                                    { key: 'articleNo', label: 'Article No' },
                                                    { key: 'brand', label: 'Brand' },
                                                    { key: 'productType', label: 'Product Type' },
                                                    { key: 'soleMaterial', label: 'Sole Material' },
                                                    { key: 'productCollection', label: 'Collection' }
                                                ];
                                                let hasAnyDetail = false;
                                                detailFields.forEach(function(field) {
                                                    if (details[field.key]) { hasAnyDetail = true; }
                                                });
                                            %>
                                            <% if (hasAnyDetail) { %>
                                                <% detailFields.forEach(function(field) { %>
                                                    <% if (details[field.key]) { %>
                                                        <li>
                                                            <label><%= field.label %></label>
                                                            <p>
                                                                <%= details[field.key] %>
                                                            </p>
                                                        </li>
                                                    <% } %>
                                                <% }); %>
                                            <% } else { %>
                                                <li>No product details available.</li>
                                            <% } %>
                                        </ul>
                                    </div>
                                    <div class="tab-pane" id="product-tab-reviews">
                                        <div class="tab tab-nav-boxed tab-nav-outline tab-nav-center">
                                            <div class="tab-content">
                                                <div class="tab-pane active" id="show-all">
                                                    <ul class="comments list-style-none" id="reviews-list">
                                                        <% if (product.reviews && product.reviews.length) { %>
                                                            <% product.reviews.forEach(function(review) { %>
                                                                <li class="comment">
                                                                    <div class="comment-body">
                                                                        <figure class="comment-avatar">
                                                                            <img src="/images/hofmaan/dummy.jpg"
                                                                                alt="Commenter Avatar" width="90"
                                                                                height="90">
                                                                        </figure>
                                                                        <div class="comment-content">
                                                                            <h4 class="comment-author">
                                                                                <a href="#">
                                                                                    <%= review.name %>
                                                                                </a>
                                                                                <span class="comment-date">
                                                                                    <%= review.createdAt ? new
                                                                                        Date(review.createdAt).toLocaleDateString('en-IN',
                                                                                        { year: 'numeric' ,
                                                                                        month: 'short' , day: 'numeric'
                                                                                        }) : '' %>
                                                                                </span>
                                                                            </h4>
                                                                            <div
                                                                                class="ratings-container comment-rating">
                                                                                <div class="ratings-full">
                                                                                    <span class="ratings"
                                                                                        style="width: <%= (review.rating/5)*100 %>%;"></span>
                                                                                    <span
                                                                                        class="tooltiptext tooltip-top"></span>
                                                                                </div>
                                                                            </div>
                                                                            <p>
                                                                                <%= review.review %>
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                </li>
                                                            <% }) %>
                                                        <% } else { %>
                                                            <li id="no-reviews-msg">No reviews yet. Be the first to review!</li>
                                                        <% } %>
                                                    </ul>
                                                    
                                                    <!-- Add Review Form -->
                                                    <div class="review-form-section">
                                                        <h3 class="review-form-title">
                                                            <i class="fas fa-star text-warning"></i>
                                                            Share Your Experience
                                                        </h3>
                                                        <form id="review-form" action="/products/<%= product._id %>/reviews" method="POST" autocomplete="off">
                                                            <div class="form-row">
                                                                <div class="form-group col-md-6">
                                                                    <label for="review-name">
                                                                        <i class="fas fa-user"></i> Your Name
                                                                    </label>
                                                                    <input type="text" id="review-name" name="name" class="form-control review-input" placeholder="Enter your name" required>
                                                                </div>
                                                                <div class="form-group col-md-6">
                                                                    <label>
                                                                        <i class="fas fa-star"></i> Your Rating
                                                                    </label>
                                                                    <div class="rating-input">
                                                                        <input type="radio" id="star5" name="rating" value="5" required>
                                                                        <label for="star5" title="5 stars">&#9733;</label>
                                                                        <input type="radio" id="star4" name="rating" value="4">
                                                                        <label for="star4" title="4 stars">&#9733;</label>
                                                                        <input type="radio" id="star3" name="rating" value="3">
                                                                        <label for="star3" title="3 stars">&#9733;</label>
                                                                        <input type="radio" id="star2" name="rating" value="2">
                                                                        <label for="star2" title="2 stars">&#9733;</label>
                                                                        <input type="radio" id="star1" name="rating" value="1">
                                                                        <label for="star1" title="1 star">&#9733;</label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="review-text">
                                                                    <i class="fas fa-comment-dots"></i> Your Review
                                                                </label>
                                                                <textarea id="review-text" name="review" class="form-control review-input" rows="4" placeholder="Write your honest feedback here..." required></textarea>
                                                            </div>
                                                            <div class="form-group text-center">
                                                                <button type="submit" class="btn btn-dark btn-lg review-submit-btn">
                                                                    <i class="fas fa-paper-plane"></i> Submit Review
                                                                </button>
                                                            </div>
                                                        </form>
                                                        <div id="review-success-message" style="display:none; margin-top: 15px;" class="alert alert-success text-center">
                                                            Thank you for your review!
                                                        </div>
                                                        <div id="review-error-message" style="display:none; margin-top: 15px;" class="alert alert-danger text-center">
                                                            Sorry, there was an error submitting your review. Please try again.
                                                        </div>
                                                    </div>
                                                    <script>
                                                        document.getElementById('review-form').addEventListener('submit', async function(e) {
                                                          e.preventDefault();
                                                          const form = e.target;
                                                    const name = form.querySelector('[name="name"]').value.trim();
                                                          const rating = form.querySelector('[name="rating"]:checked') ? form.querySelector('[name="rating"]:checked').value : '';
                                                          const review = form.querySelector('[name="review"]').value.trim();
                                                          const submitBtn = form.querySelector('button[type="submit"]');
                                                          submitBtn.disabled = true;

                                                          // Build URL-encoded body
                                                          const params = new URLSearchParams();
                                                          params.append('name', name);
                                                          params.append('rating', rating);
                                                          params.append('review', review);

                                                          try {
                                                            const res = await fetch(form.action, {
                                                              method: 'POST',
                                                              body: params,
                                                              headers: {
                                                                'Accept': 'application/json',
                                                                'Content-Type': 'application/x-www-form-urlencoded'
                                                              }
                                                            });

                                                            const data = await res.json();
                                                            if (data.success) {
                                                              const reviewList = document.getElementById('reviews-list');
                                                              const noReviewsMsg = document.getElementById('no-reviews-msg');
                                                              if (noReviewsMsg) noReviewsMsg.remove();
                                                              const dateStr = data.review.createdAt
                                                                ? new Date(data.review.createdAt).toLocaleDateString('en-IN', { year: 'numeric', month: 'short', day: 'numeric' })
                                                                : '';
                                                              const li = document.createElement('li');
                                                              li.className = 'comment';
                                                              li.innerHTML = `
                                                                <div class="comment-body">
                                                                  <figure class="comment-avatar">
                                                                    <img src="/images/hofmaan/dummy.jpg" alt="Commenter Avatar" width="90" height="90">
                                                                  </figure>
                                                                  <div class="comment-content">
                                                                    <h4 class="comment-author">
                                                                      <a href="#">${data.review.name}</a>
                                                                      <span class="comment-date">${dateStr}</span>
                                                                    </h4>
                                                                    <div class="ratings-container comment-rating">
                                                                      <div class="ratings-full">
                                                                        <span class="ratings" style="width: ${(data.review.rating/5)*100}%;"></span>
                                                                        <span class="tooltiptext tooltip-top"></span>
                                                                      </div>
                                                                    </div>
                                                                    <p>${data.review.review}</p>
                                                                  </div>
                                                                </div>
                                                              `;
                                                              reviewList.appendChild(li);

                                                              document.getElementById('review-success-message').style.display = 'block';
                                                              document.getElementById('review-error-message').style.display = 'none';
                                                              form.reset();
                                                            } else {
                                                              document.getElementById('review-success-message').style.display = 'none';
                                                              document.getElementById('review-error-message').style.display = 'block';
                                                            }
                                                          } catch (err) {
                                                            console.error(err);
                                                            document.getElementById('review-success-message').style.display = 'none';
                                                            document.getElementById('review-error-message').style.display = 'block';
                                                          }

                                                          submitBtn.disabled = false;
                                                        });
                                                    </script>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <style>
                                        /* Rating stars styling */
                                        .rating-input {
                                            display: flex;
                                            margin: 10px 0;
                                            flex-direction: row-reverse;
                                            justify-content: flex-end;
                                        }
                                        .rating-input input {
                                            display: none;
                                        }
                                        .rating-input label {
                                            font-size: 2rem;
                                            color: #ddd;
                                            cursor: pointer;
                                            margin-right: 5px;
                                            transition: color 0.2s;
                                        }
                                        .rating-input input:checked ~ label,
                                        .rating-input label:hover,
                                        .rating-input label:hover ~ label {
                                            color: #ffc107;
                                        }
                                        .review-form-section {
                                            margin-top: 40px;
                                            padding: 30px 25px 20px 25px;
                                            background: linear-gradient(135deg, #f9f9f9 80%, #ffe9c7 100%);
                                            border-radius: 10px;
                                            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
                                            position: relative;
                                            overflow: hidden;
                                        }
                                        .review-form-title {
                                            margin-bottom: 25px;
                                            font-size: 22px;
                                            font-weight: 700;
                                            color: #222;
                                            text-align: center;
                                            letter-spacing: 0.5px;
                                        }
                                        .form-row {
                                            display: flex;
                                            flex-wrap: wrap;
                                            gap: 20px;
                                        }
                                        .form-group {
                                            margin-bottom: 20px;
                                            flex: 1 1 100%;
                                        }
                                        .form-group.col-md-6 {
                                            flex: 1 1 45%;
                                            min-width: 200px;
                                        }
                                        .form-group label {
                                            display: block;
                                            margin-bottom: 8px;
                                            font-weight: 500;
                                            color: #444;
                                        }
                                        .review-input {
                                            border-radius: 6px;
                                            border: 1px solid #e0e0e0;
                                            padding: 10px 14px;
                                            font-size: 1rem;
                                            background: #fff;
                                            transition: border-color 0.2s;
                                        }
                                        .review-input:focus {
                                            border-color: #ffc107;
                                            outline: none;
                                            box-shadow: 0 0 0 2px #ffe9c7;
                                        }
                                        .review-submit-btn {
                                            padding: 10px 32px;
                                            font-size: 1.1rem;
                                            border-radius: 25px;
                                            background: linear-gradient(90deg, #222 60%, #ffc107 100%);
                                            border: none;
                                            color: #fff;
                                            font-weight: 600;
                                            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
                                            transition: background 0.2s, box-shadow 0.2s;
                                        }
                                        .review-submit-btn:hover {
                                            background: linear-gradient(90deg, #ffc107 60%, #222 100%);
                                            color: #222;
                                            box-shadow: 0 4px 16px rgba(255,193,7,0.12);
                                        }
                                        @media (max-width: 600px) {
                                            .form-row {
                                                flex-direction: column;
                                                gap: 0;
                                            }
                                            .form-group.col-md-6 {
                                                min-width: 100%;
                                            }
                                            .review-form-section {
                                                padding: 18px 8px 10px 8px;
                                            }
                                        }
                                    </style>
                                </div>
                            </div>
                            <section class="related-product-section">
                                <div class="title-link-wrapper mb-4">
                                    <h4 class="title">Related Products</h4>
                                    <a href="#" class="btn btn-dark btn-link btn-slide-right btn-icon-right">More
                                        Products<i class="w-icon-long-arrow-right"></i></a>
                                </div>
                                <div class="swiper-container swiper-theme" data-swiper-options="{
                                    'spaceBetween': 20,
                                    'slidesPerView': 2.2,
                                    'breakpoints': {
                                        '576': {
                                            'slidesPerView': 1.2
                                        },
                                        '768': {
                                            'slidesPerView': 4
                                        },
                                        '992': {
                                            'slidesPerView': 4
                                        }
                                    }
                                }">
                                    <div class="swiper-wrapper row cols-lg-3 cols-md-4 cols-sm-3 cols-2">
                                        <% if (relatedProducts && relatedProducts.length) { %>
                                            <% relatedProducts.forEach(function(rp) { %>
                                                <div class="swiper-slide product"
                                                    style="border: 2px solid #dfdfdf;padding: 3px; border-radius: 6px;">
                                                    <figure class="product-media">
                                                        <a href="/product/<%= rp.slug || rp._id %>">
                                                            <img src="<%= (rp.images && rp.images[0]) || '/images/hofmaan/sample3.jpg' %>"
                                                                alt="Product" width="300" height="338" />
                                                            <% if (rp.images && rp.images[1]) { %>
                                                                <img src="<%= rp.images[1] %>" alt="Product" width="300"
                                                                    height="338" />
                                                                <% } %>
                                                        </a>

                                                        <div class="product-action">
                                                            <% if (typeof rp.stock==='number' && rp.stock> 0) { %>
                                                                <button class="btn-product btn-add-to-cart"
                                                                    style="cursor: pointer;" title="Add to Cart"
                                                                    data-product-id="<%= rp._id %>"
                                                                    data-product-name="<%= rp.name %>"
                                                                    data-product-image="<%= (rp.images && rp.images[0]) || '/images/hofmaan/sample3.jpg' %>"
                                                                    data-product-price="<%= rp.salePrice || rp.basePrice || rp.price %>">
                                                                    Add To Cart
                                                                </button>
                                                                <% } else { %>
                                                                    <span class="btn btn-danger disabled">Out of
                                                                        Stock</span>
                                                                    <% } %>
                                                        </div>
                                                    </figure>
                                                    <div class="product-details related-details">
                                                        <h4 class="product-name">
                                                            <a href="/product/<%= rp.slug || rp._id %>">
                                                                <%= rp.name %>
                                                            </a>
                                                        </h4>

                                                        <div class="product-pa-wrapper">
                                                            <div class="product-price">
                                                                <% var showOldPrice=(typeof rp.basePrice==='number' &&
                                                                    typeof rp.salePrice==='number' && rp.salePrice <
                                                                    rp.basePrice && rp.salePrice> 0); %>
                                                                    <% if (showOldPrice) { %>
                                                                        <del class="old-price"><span
                                                                                class="rupee-symbol">₹</span>
                                                                            <%= rp.basePrice %>
                                                                        </del>
                                                                        <ins class="new-price"><span
                                                                                class="rupee-symbol">₹</span>
                                                                            <%= rp.salePrice %>
                                                                        </ins>
                                                                        <% } else if (typeof rp.basePrice==='number' ) {
                                                                            %>
                                                                            ₹<%= rp.basePrice %>
                                                                                <% } else if (typeof rp.price==='number'
                                                                                    ) { %>
                                                                                    ₹<%= rp.price %>
                                                                                        <% } else { %>
                                                                                            Price Unavailable
                                                                                            <% } %>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <% }) %>
                                                    <% } else { %>
                                                        <div class="swiper-slide">No related products found.</div>
                                                        <% } %>
                                    </div>



                                    <script>
                                        document.addEventListener('DOMContentLoaded', function () {
                                            // Handle color selection
                                            document.querySelectorAll('.color-option').forEach(option => {
                                                option.addEventListener('click', function () {
                                                    const container = this.closest('.color-options-container');
                                                    container.querySelectorAll('.color-option').forEach(opt => {
                                                        opt.classList.remove('selected');
                                                    });
                                                    this.classList.add('selected');
                                                });
                                            });

                                            // Handle size selection
                                            document.querySelectorAll('.size-option').forEach(option => {
                                                option.addEventListener('click', function () {
                                                    const container = this.closest('.size-options-container');
                                                    container.querySelectorAll('.size-option').forEach(opt => {
                                                        opt.classList.remove('selected');
                                                    });
                                                    this.classList.add('selected');
                                                });
                                            });

                                            // Add to Cart functionality
                                            document.querySelectorAll('.btn-add-to-cart').forEach(btn => {
                                                btn.addEventListener('click', async function (e) {
                                                    e.preventDefault();

                                                    const productCard = this.closest('.product');
                                                    const cartItem = {
                                                        productId: this.getAttribute('data-product-id'),
                                                        productName: this.getAttribute('data-product-name'),
                                                        productImage: this.getAttribute('data-product-image'),
                                                        price: parseFloat(this.getAttribute('data-product-price')) || 0,
                                                        quantity: 1
                                                    };

                                                    // Get selected color
                                                    const colorContainer = productCard.querySelector('.color-options-container');
                                                    if (colorContainer) {
                                                        const selectedColor = colorContainer.querySelector('.color-option.selected');
                                                        if (selectedColor) {
                                                            cartItem.selectedColor = selectedColor.getAttribute('data-color');
                                                            cartItem.colorVariantId = selectedColor.getAttribute('data-color-id');
                                                        } else {
                                                            showToast('Please select a color', 'error');
                                                            return;
                                                        }
                                                    }

                                                    // Get selected size
                                                    const sizeContainer = productCard.querySelector('.size-options-container');
                                                    if (sizeContainer) {
                                                        const selectedSize = sizeContainer.querySelector('.size-option.selected');
                                                        if (selectedSize) {
                                                            cartItem.selectedSize = selectedSize.getAttribute('data-size');
                                                            cartItem.sizeVariantId = selectedSize.getAttribute('data-size-id');
                                                        } else {
                                                            showToast('Please select a size', 'error');
                                                            return;
                                                        }
                                                    }

                                                    await addToCart(cartItem);
                                                });
                                            });

                                            async function addToCart(cartItem) {
                                                const isLoggedIn = window.isLoggedIn === true || window.isLoggedIn === 'true';

                                                if (isLoggedIn) {
                                                    try {
                                                        const response = await fetch('/add-cart', {
                                                            method: 'POST',
                                                            headers: {
                                                                'Content-Type': 'application/json'
                                                            },
                                                            credentials: 'include',
                                                            body: JSON.stringify(cartItem)
                                                        });

                                                        const data = await response.json();

                                                        if (data.error) {
                                                            showToast(data.error, 'error');
                                                            return;
                                                        }

                                                        showToast('Product added to cart successfully!', 'success');
                                                    } catch (error) {
                                                        console.error('Error adding to cart:', error);
                                                        showToast('Error adding product to cart', 'error');
                                                    }
                                                } else {
                                                    try {
                                                        let guestCart = JSON.parse(localStorage.getItem('guestCart')) || [];

                                                        // Check if item with same variants exists
                                                        const existingItemIndex = guestCart.findIndex(item =>
                                                            item.productId === cartItem.productId &&
                                                            item.selectedColor === cartItem.selectedColor &&
                                                            item.selectedSize === cartItem.selectedSize
                                                        );

                                                        if (existingItemIndex > -1) {
                                                            guestCart[existingItemIndex].quantity += cartItem.quantity;
                                                        } else {
                                                            guestCart.push(cartItem);
                                                        }

                                                        localStorage.setItem('guestCart', JSON.stringify(guestCart));
                                                        showToast('Product added to cart successfully!', 'success');
                                                    } catch (error) {
                                                        console.error('Error adding to guest cart:', error);
                                                        showToast('Error adding product to cart', 'error');
                                                    }
                                                }
                                            }

                                            function showToast(message, type = 'success') {
                                                Toastify({
                                                    text: message,
                                                    duration: 3000,
                                                    close: true,
                                                    gravity: "top",
                                                    position: "right",
                                                    backgroundColor: type === "success"
                                                        ? "linear-gradient(90deg, #00b09b, #96c93d)"
                                                        : "linear-gradient(90deg, #e74c3c, #c0392b)",
                                                    stopOnFocus: true
                                                }).showToast();
                                            }
                                        });
                                    </script>
                                </div>
                            </section>

                            <script>
                                // Swiper instance variables
                                let mainSwiper = null;
                                let thumbsSwiper = null;

                                function reinitializeSwipers() {
                                    // Destroy previous Swipers if exist
                                    if (mainSwiper) {
                                        mainSwiper.destroy(true, true);
                                    }
                                    if (thumbsSwiper) {
                                        thumbsSwiper.destroy(true, true);
                                    }
                                    // Re-initialize Swipers
                                    thumbsSwiper = new Swiper('.product-thumbs-wrap', {
                                        spaceBetween: 10,
                                        slidesPerView: 4,
                                        freeMode: true,
                                        watchSlidesProgress: true,
                                        navigation: {
                                            nextEl: '.swiper-button-next',
                                            prevEl: '.swiper-button-prev',
                                        },
                                    });
                                    mainSwiper = new Swiper('.product-single-swiper', {
                                        loop: false,
                                        spaceBetween: 10,
                                        navigation: {
                                            nextEl: '.swiper-button-next',
                                            prevEl: '.swiper-button-prev',
                                        },
                                        thumbs: {
                                            swiper: thumbsSwiper
                                        }
                                    });
                                    // Link Swipers
                                    if (mainSwiper && thumbsSwiper) {
                                        mainSwiper.controller.control = thumbsSwiper;
                                        thumbsSwiper.controller.control = mainSwiper;
                                    }
                                }

                                document.addEventListener('DOMContentLoaded', function () {
                                    // Color swatch logic
                                    const colorVariants = document.querySelectorAll('#color-options .color');
                                    const resetColorBtn = document.getElementById('reset-color');
                                    const mainImagesContainer = document.getElementById('main-product-images');
                                    const thumbsContainer = document.getElementById('product-thumbs');
                                    // Size swatch logic
                                    const sizeVariants = document.querySelectorAll('#size-options .size');
                                    const resetSizeBtn = document.getElementById('reset-size');

                                    // Store original images
                                    const originalImages = [
                                        <% let defaultImages = (product.images && product.images.length) ?
                                            product.images : ['/images/hofmaan/sampleimage.jpg']; %>
                                        <% defaultImages.forEach(function (img) { %>
                                                '<%= img %>',
                                        <% }) %>
                                    ];

                                    // Function to update product images
                                    function updateProductImages(images) {
                                        // Remove all children
                                        mainImagesContainer.innerHTML = '';
                                        thumbsContainer.innerHTML = '';
                                        // Only use unique images (avoid duplicates)
                                        const uniqueImages = Array.from(new Set(images));
                                        uniqueImages.forEach((img, index) => {
                                            // Main image slide
                                            const slideDiv = document.createElement('div');
                                            slideDiv.className = 'swiper-slide';
                                            const figure = document.createElement('figure');
                                            figure.className = 'product-image';
                                            const imgEl = document.createElement('img');
                                            imgEl.src = img;
                                            imgEl.setAttribute('data-zoom-image', img);
                                            imgEl.alt = '<%= product.name %> Image ' + (index + 1);
                                            imgEl.width = 800;
                                            imgEl.height = 900;
                                            figure.appendChild(imgEl);
                                            slideDiv.appendChild(figure);
                                            mainImagesContainer.appendChild(slideDiv);
                                            // Thumbnail
                                            const thumbDiv = document.createElement('div');
                                            thumbDiv.className = 'product-thumb swiper-slide';
                                            const thumbImg = document.createElement('img');
                                            thumbImg.src = img;
                                            thumbImg.alt = 'Product Thumb ' + (index + 1);
                                            thumbImg.width = 100;
                                            thumbImg.height = 110;
                                            thumbImg.style.objectFit = 'cover';
                                            thumbDiv.appendChild(thumbImg);
                                            thumbsContainer.appendChild(thumbDiv);
                                        });
                                        // Re-initialize Swipers after DOM update
                                        setTimeout(reinitializeSwipers, 0);
                                    }

                                    // Function to reset to original images
                                    function resetToOriginalImages() {
                                        colorVariants.forEach(v => v.classList.remove('active'));
                                        updateProductImages(originalImages);
                                        resetColorBtn.classList.remove('visible');
                                    }

                                    // Add click event listeners to color variants
                                    colorVariants.forEach(variant => {
                                        variant.addEventListener('click', function (e) {
                                            e.preventDefault();
                                            // Remove active class from all variants
                                            colorVariants.forEach(v => v.classList.remove('active'));
                                            // Add active class to clicked variant
                                            this.classList.add('active');
                                            // Get the variant image
                                            const variantImage = this.getAttribute('data-image');
                                            // If variant has an image, use it, otherwise use original images
                                            let imagesToShow;
                                            if (variantImage && variantImage.trim() !== '') {
                                                imagesToShow = [variantImage];
                                            } else {
                                                imagesToShow = originalImages;
                                            }
                                            updateProductImages(imagesToShow);
                                            resetColorBtn.classList.add('visible');
                                        });
                                    });

                                    // Add click event listener to reset button
                                    if (resetColorBtn) {
                                        resetColorBtn.addEventListener('click', function (e) {
                                            e.preventDefault();
                                            resetToOriginalImages();
                                        });
                                    }

                                    // --- Size swatch logic ---
                                    function resetSizeSelection() {
                                        sizeVariants.forEach(v => v.classList.remove('active'));
                                        resetSizeBtn.classList.remove('visible');
                                    }
                                    sizeVariants.forEach(variant => {
                                        variant.addEventListener('click', function (e) {
                                            e.preventDefault();
                                            sizeVariants.forEach(v => v.classList.remove('active'));
                                            this.classList.add('active');
                                            resetSizeBtn.classList.add('visible');
                                        });
                                    });
                                    if (resetSizeBtn) {
                                        resetSizeBtn.addEventListener('click', function (e) {
                                            e.preventDefault();
                                            resetSizeSelection();
                                        });
                                    }

                                    // Initialize Swipers on page load
                                    reinitializeSwipers();
                                });
                            </script>
                        </div>

                    </div>
                    <!-- End of Main Content -->

                    <!-- End of Sidebar -->
                </div>
            </div>
    </div>
    <!-- End of Page Content -->
    </main>
    <!-- End of Main -->

    <!-- Start of Footer -->
    <footer class="footer appear-animate" data-animation-options="{
        'name': 'fadeIn'
    }">
        <div class="footer-newsletter bg-primary">
            <div class="container">
                <div class="row justify-content-center align-items-center">
                    <div class="col-xl-5 col-lg-6">
                        <div class="icon-box icon-box-side text-white">
                            <div class="icon-box-icon d-inline-flex">
                                <i class="w-icon-envelop3"></i>
                            </div>
                            <div class="icon-box-content">
                                <h4 class="icon-box-title text-white text-uppercase font-weight-bold">Subscribe To
                                    Our Newsletter</h4>
                                <p class="text-white">Get all the latest information on Events, Sales and Offers.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-7 col-lg-6 col-md-9 mt-4 mt-lg-0 ">
                        <form action="#" method="get" class="input-wrapper input-wrapper-inline input-wrapper-rounded">
                            <input type="email" class="form-control mr-2 bg-white" name="email" id="email"
                                placeholder="Your E-mail Address" />
                            <button class="btn btn-dark btn-rounded" type="submit">Subscribe<i
                                    class="w-icon-long-arrow-right"></i></button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="footer-top">
                <div class="row">
                    <div class="col-lg-4 col-sm-6">
                        <div class="widget widget-about mt-0 mb-4">
                            <a href="/" class="logo-footer">
                                <img src="/images/logo.png" alt="logo-footer" width="200" height="45" />
                            </a>
                            <div class="widget-body">
                                <p class="widget-about-title">Got Question? Call us 24/7</p>
                                <a href="tel:+919400947122" class="widget-about-call">+91 9400947122</a>
                                <p>Follow Us In :</p>
                                <div class="social-icons social-icons-colored">
                                    <a target="_blank" href="https://www.facebook.com/profile.php?id=61577041363849#"
                                        class="social-icon social-facebook w-icon-facebook"></a>
                                    <a target="_blank"
                                        href="https://www.instagram.com/hofmaan.official/?fbclid=IwY2xjawLJwfRleHRuA2FlbQIxMQBicmlkETFtbmQ0UnlRc3gyNDAwaU44AR5ZqTiWzEixcnjCAnjWdJJKxyOo1SDmgvhwN8_53T5gbWCz_nWAy3l3UTZALw_aem_icwl_UgQrgnfthtQ81Mmyw"
                                        class="social-icon social-instagram w-icon-instagram"></a>
                                    <a target="_blank" href="https://www.youtube.com/@hofmaanofficial"
                                        class="social-icon social-youtube w-icon-youtube"></a>
                                    <a target="_blank" href="https://in.pinterest.com/hofmaan_official/"
                                        class="social-icon social-pinterest w-icon-pinterest"></a>
                                    <a href="https://www.linkedin.com/company/107658144/admin/page-posts/published/"
                                        class="social-icon" target="_blank" rel="noopener noreferrer">
                                        <i style="color: blue;" class="fab fa-linkedin-in"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-sm-6">
                        <div class="widget">
                            <h3 class="widget-title">Company</h3>
                            <ul class="widget-body">
                                <li><a href="/">Home</a></li>
                                <li><a href="/store">Store</a></li>
                                <li><a href="/about">About Us</a></li>
                                <li><a href="/blogs">Blogs</a></li>
                                <li><a href="/contact">Contact Us</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-3 col-sm-6">
                        <div class="widget">
                            <h4 class="widget-title">My Account</h4>
                            <ul class="widget-body">
                                <li><a href="/orders">Track My Order</a></li>
                                <li><a href="/cart">View Cart</a></li>
                                <% if (user) { %>
                                    <li><a href="/account">Account</a></li>
                                    <% } else { %>
                                        <li><a href="/auth/login">Sign In</a></li>
                                        <% } %>
                                            <li><a href="/wishlist">My Wishlist</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-3 col-sm-6">
                        <div class="widget">
                            <h4 class="widget-title">Customer Service</h4>
                            <ul class="widget-body">
                                <li><a href="/terms_and_conditions">Terms and Conditions</a></li>
                                <li><a href="/Cancellation_Refund">Cancellation Refund</a></li>
                                <li><a href="/shipping_policy">Shipping Policy</a></li>
                                <li><a href="/privacy_policy">Privacy Policy</a></li>

                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <div class="footer-left">
                    <p class="copyright">
                        Copyright © 2025 Hofmaan. All Rights Reserved. &nbsp;|&nbsp;
                        developed by <a href="https://trivlogic.com/" target="_blank" rel="noopener"
                            style="color:#888;text-decoration:none;">Trivlogic Pvt Ltd</a>
                    </p>
                </div>
                <div class="footer-right">
                    <span class="payment-label mr-lg-8">We're using safe payment for</span>
                    <figure class="payment">
                        <img src="/images/payment.png" alt="payment" width="159" height="25" />
                    </figure>
                </div>
            </div>
        </div>
    </footer>
    <!-- End of Footer -->
    </div>
    <!-- End of Page Wrapper -->

    <!-- Start of Sticky Footer -->
    <div class="btm-main">
        <a href="#" id="mobileSearchRedirect" class="search-bar-link">
            <div class="search-bar" id="searchBar">
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search search-input-icon"></i>
                        <input type="text" class="search-input" placeholder="Search products..." id="mobileSearchInput">
                    </div>
                    <button class="search-btn" id="mobileSearchButton">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </a>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const input = document.getElementById('mobileSearchInput');
                const btn = document.getElementById('mobileSearchButton');
                const link = document.getElementById('mobileSearchRedirect');
                function doSearch(e) {
                    e.preventDefault();
                    const q = input.value.trim();
                    if (q.length > 0) {
                        window.location.href = '/store?q=' + encodeURIComponent(q);
                    }
                }
                btn.addEventListener('click', doSearch);
                input.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') {
                        doSearch(e);
                    }
                });
                link.addEventListener('click', function (e) {
                    // Prevent default link if not searching
                    if (input.value.trim().length === 0) e.preventDefault();
                });
            });
        </script>

        <nav class="mobile-bottom-nav">

            <div class="mob-btm-nav">
                <a href="/cart" class="sticky-link1">
                    <i class="fas fa-shopping-cart"></i>
                    <p>Cart</p>
                </a>
            </div>

            <div class="mob-btm-nav">
                <a href="/orders" class="sticky-link1">
                    <i class="fas fa-clipboard-list"></i>
                    <p>Orders</p>
                </a>
            </div>

            <div class="mob-btm-nav">
                <a href="#0" id="searchBtn" class="sticky-link1">
                    <i class="fas fa-search"></i>
                    <p>Search</p>
                </a>
            </div>

            <div class="mob-btm-nav">
                <a href="/wishlist" class="sticky-link1">
                    <i class="fas fa-heart"></i>
                    <p>Wishlist</p>
                </a>
            </div>
        </nav>
    </div>

    <div class="sticky-footer sticky-content fix-bottom">

        <a href="/" class="sticky-link  ">
            <i class="w-icon-home"></i>
            <p>Home</p>
        </a>
        <a href="/store" class="sticky-link active-mob">
            <i class="w-icon-products"></i>
            <p>Store</p>
        </a>
        <a class="btm-img" href="/"> <img src="/images/logo-2.png" alt=""></a>
        <% if (user) { %>
            <a href="/account" class="sticky-link">
                <i class="w-icon-account"></i>
                <p>Account</p>
            </a>
            <% } else { %>
                <a href="/auth/login" class="sticky-link">
                    <i class="w-icon-account"></i>
                    <p>Login</p>
                </a>
                <% } %>


                    <a href="/contact" class="sticky-link">
                        <i class="w-icon-call2"></i>
                        <p>Contact </p>
                    </a>
    </div>
    <!-- End of Sticky Footer -->

    <!-- Start of Scroll Top -->
    <a id="scroll-top" class="scroll-top" href="#top" title="Top" role="button"> <i class="w-icon-angle-up"></i> <svg
            version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 70">
            <circle id="progress-indicator" fill="transparent" stroke="#000000" stroke-miterlimit="10" cx="35" cy="35"
                r="34" style="stroke-dasharray: 16.4198, 400;"></circle>
        </svg> </a>
    <!-- End of Scroll Top -->

    <!-- Start of Mobile Menu -->
    <div class="mobile-menu-wrapper">
        <div class="mobile-menu-overlay"></div>
        <!-- End of .mobile-menu-overlay -->

        <a href="#" class="mobile-menu-close"><i class="close-icon"></i></a>
        <!-- End of .mobile-menu-close -->

        <div class="mobile-menu-container scrollable">
            <img class="side-logo" src="/images/logo.png" alt="logo">
            <!-- End of Search Form -->
            <div class="tab">
                <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item">
                        <a href="#main-menu" class="nav-link active">Main Menu</a>
                    </li>
                    <li class="nav-item">
                        <a href="#categories" class="nav-link">Categories</a>
                    </li>
                </ul>
            </div>
            <div class="tab-content">
                <div class="tab-pane active" id="main-menu">
                    <ul class="mobile-menu">
                        <li><a href="/">Home</a></li>
                        <li><a href="/store">Store</a></li>
                        <% if (user) { %>
                        <li><a href="/account">Profile</a></li>
                        <% } else { %>
                        <li><a href="/auth/login">Login</a></li>
                        <% } %>
                        <li><a href="/wishlist">Wishlist</a></li>
                        <li><a href="/cart">Cart</a></li>
                        <li><a href="/about">About Us</a></li>
                        <li><a href="/blogs">Blogs</a></li>
                        <li><a href="/contact">Contact Us</a></li>

                    </ul>
                </div>
                <div class="tab-pane" id="categories">
                    <ul class="mobile-menu">
                        <% categories.forEach(category=> { %>
                            <li>
                                <a style="gap: 10px!important; display: flex;" href="/store?category=<%= category._id %>">
                                    <img style="height: 30px; width: 30px; border-radius: 50px;"
                                        src="<%= category.imageUrl || '/images/hofmaan/sample3.jpg' %>" alt="">
                                    <%= category.name %>
                                </a>
                                <% if (category.subCategories && category.subCategories.length> 0) { %>
                                    <ul>
                                        <% category.subCategories.forEach(sub=> { %>
                                            <% if (sub.isActive) { %>
                                                <li>
                                                    <a href="/store?subcategory=<%= sub._id %>">
                                                        <%= sub.name %>
                                                    </a>
                                                </li>
                                                <% } %>
                                                    <% }); %>
                                    </ul>
                                    <% } %>
                            </li>
                            <% }); %>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- End of Mobile Menu -->

    <!-- Root element of PhotoSwipe. Must have class pswp -->
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

        <!-- Background of PhotoSwipe. It's a separate element as animating opacity is faster than rgba(). -->
        <div class="pswp__bg"></div>

        <!-- Slides wrapper with overflow:hidden. -->
        <div class="pswp__scroll-wrap">


            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>

            <div class="pswp__ui pswp__ui--hidden">

                <div class="pswp__top-bar">


                    <div class="pswp__counter"></div>

                    <button class="pswp__button pswp__button--close" aria-label="Close (Esc)"></button>
                    <button class="pswp__button pswp__button--zoom" aria-label="Zoom in/out"></button>

                    <div class="pswp__preloader">
                        <div class="loading-spin"></div>
                    </div>
                </div>

                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                    <div class="pswp__share-tooltip"></div>
                </div>

                <button class="pswp__button--arrow--left" aria-label="Previous (arrow left)"></button>
                <button class="pswp__button--arrow--right" aria-label="Next (arrow right)"></button>

                <div class="pswp__caption">
                    <div class="pswp__caption__center"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- End of PhotoSwipe -->
    <!--whats app icon -->
    <div class="whatsapp-float">
        <a href="https://wa.me/+919400947122" target="_blank" rel="noopener noreferrer">
            <i class="fab fa-whatsapp whatsapp-icon"></i>
        </a>
    </div>
    <script>
        window.isLoggedIn = <%= user ? 'true' : 'false' %>;
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchInput = document.getElementById('searchInput');
            const searchForm = document.getElementById('searchForm');
            const suggestionsContainer = document.getElementById('searchSuggestions');
            const resultsContainer = document.getElementById('searchResults');
            let searchTimeout;

            // Helper to safely format price
            function formatPrice(price) {
                if (typeof price === 'number' && !isNaN(price)) {
                    return price.toLocaleString('en-IN');
                }
                if (typeof price === 'string' && price.trim() !== '' && !isNaN(Number(price))) {
                    return Number(price).toLocaleString('en-IN');
                }
                return '';
            }

            // Search input handler
            searchInput.addEventListener('input', function (e) {
                clearTimeout(searchTimeout);
                const query = e.target.value.trim();

                if (query.length < 2) {
                    suggestionsContainer.style.display = 'none';
                    return;
                }

                searchTimeout = setTimeout(() => {
                    fetchSuggestions(query);
                }, 300);
            });

            // Form submission handler
            searchForm.addEventListener('submit', function (e) {
                e.preventDefault();
                const query = searchInput.value.trim();
                if (query) {
                    performSearch(query);
                }
            });

            // Close results when clicking outside
            document.addEventListener('click', function (e) {
                if (!searchForm.contains(e.target)) {
                    suggestionsContainer.style.display = 'none';
                    resultsContainer.style.display = 'none';
                }
            });

            // Fetch search suggestions
            async function fetchSuggestions(query) {
                try {
                    const response = await fetch(`/search/suggestions?q=${encodeURIComponent(query)}`);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const suggestions = await response.json();

                    if (!Array.isArray(suggestions)) {
                        throw new Error('Invalid suggestions format');
                    }

                    displaySuggestions(suggestions);
                } catch (error) {
                    console.error('Error fetching suggestions:', error);
                    suggestionsContainer.style.display = 'none';
                    suggestionsContainer.innerHTML = '<div class="error-message">Failed to load suggestions</div>';
                }
            }

            // Display suggestions
            function displaySuggestions(suggestions) {
                if (!suggestions || suggestions.length === 0) {
                    suggestionsContainer.innerHTML = '<div class="no-suggestions">No suggestions found</div>';
                    suggestionsContainer.style.display = 'block';
                    return;
                }

                suggestionsContainer.innerHTML = '';
                suggestions.forEach(item => {
                    const suggestionItem = document.createElement('div');
                    suggestionItem.className = 'suggestion-item';
                    suggestionItem.innerHTML = `
        ${item.images?.length ? `<img src="${item.images[0]}" alt="${item.name}" />` : ''}
        <div class="suggestion-text">
            <div class="suggestion-name">${item.name}</div>
            <div class="suggestion-price">₹${formatPrice(item.basePrice)}</div>
        </div>
    `;
                    // ✅ Navigate to product page directly
                    suggestionItem.addEventListener('click', () => {
                        window.location.href = `/product/${item._id}`;
                    });
                    suggestionsContainer.appendChild(suggestionItem);
                });
                suggestionsContainer.style.display = 'block';
            }

            // Perform full search
            async function performSearch(query) {
                try {
                    const response = await fetch(`/search?q=${encodeURIComponent(query)}`);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const results = await response.json();

                    if (!Array.isArray(results)) {
                        throw new Error('Invalid results format');
                    }

                    displaySearchResults(query, results);
                } catch (error) {
                    console.error('Error performing search:', error);
                    displaySearchResults(query, []);
                }
            }

            // Display search results
            function displaySearchResults(query, products) {
                suggestionsContainer.style.display = 'none';

                if (!products || products.length === 0) {
                    resultsContainer.innerHTML = `
            <div class="no-results">
                <h3>No results found for "${query}"</h3>
                <p>Try different keywords or browse our categories</p>
            </div>
        `;
                } else {
                    resultsContainer.innerHTML = `
            <div class="search-results-header">
                <h3>Results for "${query}" (${products.length})</h3>
                <span class="close-results">&times;</span>
            </div>
            <div class="search-results-grid">
                ${products.map(product => {
                        const priceStr = formatPrice(product.basePrice);
                        return `
                    <div class="search-result-item">
                        <a href="/product/${product._id}">
                            <img src="${product.images?.[0] || '/images/placeholder.jpg'}" alt="${product.name}" />
                            <div class="item-details">
                                <h4>${product.name}</h4>
                            <div class="item-price">₹${formatPrice(product.salePrice || product.basePrice)}</div>
                                ${product.description ? `<p class="item-desc">${product.description.substring(0, 60)}...</p>` : ''}
                            </div>
                        </a>
                    </div>
                    `;
                    }).join('')}
            </div>
        `;
                }

                // Show results container
                resultsContainer.style.display = 'block';

                // Close button handler
                const closeBtn = resultsContainer.querySelector('.close-results');
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        resultsContainer.style.display = 'none';
                    });
                }
            }
        });
    </script>

    <!-- Plugin JS File -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="/vendor/jquery/jquery.min.js"></script>
    <script src="/vendor/sticky/sticky.js"></script>
    <script src="/vendor/jquery.plugin/jquery.plugin.min.js"></script>
    <script src="/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
    <script src="/vendor/magnific-popup/jquery.magnific-popup.min.js"></script>
    <script src="/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="/vendor/zoom/jquery.zoom.js"></script>
    <script src="/vendor/photoswipe/photoswipe.js"></script>
    <script src="/vendor/photoswipe/photoswipe-ui-default.js"></script>

    <!-- Swiper JS -->
    <script src="/vendor/swiper/swiper-bundle.min.js"></script>

    <!-- Main JS File -->
    <script src="/js/main.min.js"></script>
    <script src="/js/script.js"></script>
  
</body>



</html>