<!DOCTYPE html>
<html lang="en">


<meta http-equiv="content-type" content="text/html;charset=UTF-8" />

<head>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-KTMNTPV3');</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">


    <title>Hofmaan | Account</title>

    <meta name="keywords" content="Hofmaan" />
    <meta name="description" content="Hofmaan">
    <meta name="author" content="Trivlogic">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/images/logo-2.png">

    <!-- WebFont.js -->
    <script>
        WebFontConfig = {
            google: { families: ['Poppins:â‚¹00,500,600,700'] }
        };
        (function (d) {
            var wf = d.createElement('script'), s = d.scripts[0];
            wf.src = '/js/webfont.js';
            wf.async = true;
            s.parentNode.insertBefore(wf, s);
        })(document);
    </script>

    <link rel="preload" href="/vendor/fontawesome-free/webfonts/fa-regular-â‚¹00.woff2" as="font" type="font/woff2"
        crossorigin="anonymous">
    <link rel="preload" href="/vendor/fontawesome-free/webfonts/fa-solid-900.woff2" as="font" type="font/woff2"
        crossorigin="anonymous">
    <link rel="preload" href="/vendor/fontawesome-free/webfonts/fa-brands-â‚¹00.woff2" as="font" type="font/woff2"
        crossorigin="anonymous">
    <link rel="preload" href="/fonts/wolmart87d5.woff?png09e" as="font" type="font/woff" crossorigin="anonymous">

    <!-- Vendor CSS -->
    <link rel="stylesheet" type="text/css" href="/vendor/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="/vendor/swiper/swiper-bundle.min.css">

    <!-- Plugin CSS -->
    <link rel="stylesheet" type="text/css" href="/vendor/magnific-popup/magnific-popup.min.css">

    <!-- Default CSS -->
    <link rel="stylesheet" type="text/css" href="/css/style.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
        /* === Modal Overlay === */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            padding: 20px;
            overflow-y: auto;
        }

        /* === Modal Container === */
        .address-modal-container {
            background: #fff;
            border-radius: 8px;
            width: 100%;
            max-width: 90%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            animation: fadeInScale 0.3s ease-in-out;
        }

        /* === Header === */
        .modal-header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #ddd;
        }

        .modal-title-text {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .modal-close-btn {
            font-size: 24px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close-btn:hover {
            color: #000;
        }

        /* === Form Area === */
        .form-content-area {
            padding: 20px;
        }

        .address-edit-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-input-group {
            display: flex;
            flex-direction: column;
        }

        .form-input-group label {
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-input-group input,
        .form-input-group select {
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
            transition: border 0.3s ease;
        }

        .form-input-group input:focus,
        .form-input-group select:focus {
            outline: none;
            border-color: #007bff;
        }

        /* === Checkbox Customization === */
        .form-input-group input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }

        /* === Buttons === */
        .modal-action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }

        .modal-action-buttons button {
            padding: 10px 18px;
            font-size: 14px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .modal-action-buttons #cancelBtn {
            background: #f1f1f1;
            color: #333;
        }

        .modal-action-buttons #cancelBtn:hover {
            background: #e0e0e0;
        }

        .modal-action-buttons button[type="submit"] {
            background: #007bff;
            color: white;
        }

        .modal-action-buttons button[type="submit"]:hover {
            background: #0056b3;
        }

        /* === Animation === */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* === Responsive === */
        @media (max-width: 576px) {
            .address-modal-container {
                width: 100%;
                border-radius: 0;
                height: auto;
            }

            .form-content-area {
                padding: 15px;
            }
        }
    </style>
</head>

<body class="my-account">
    <div class="page-wrapper">
        <!-- Start of Header -->
        <header class="header">
            <div class="header-top">
                <div class="container">
                    <div class="header-left">
                        <p class="welcome-msg">Welcome to Hofmaan Store! Offers Available</p>
                    </div>
                    <div class="header-right">
                        <span class="divider d-lg-show"></span>
                        <a href="/store" class="d-lg-show">Store</a>
                        <a href="/about" class="d-lg-show">About Us</a>
                        <a href="/contact" class="d-lg-show">Contact Us</a>
                        <% if (user) { %>
                            <a href="/account" class="d-lg-show"><i class="w-icon-account"></i>Profile</a>
                            <span class="delimiter d-lg-show">/</span>
                            <a href="/orders" class="ml-0 d-lg-show">My Orders</a>
                            <% } else { %>
                                <a href="/auth/login" class="d-lg-show"><i class="w-icon-account"></i>Sign In</a>
                                <span class="delimiter d-lg-show">/</span>
                                <a href="/auth/login" class="ml-0 d-lg-show">Register</a>
                                <% } %>
                    </div>
                </div>
            </div>
            <!-- End of Header Top -->
            <div class="header-middle sticky-content fix-top sticky-header border-no">
                <div class="container">
                    <div class="header-left mr-md-4">
                        <a href="#" class="mobile-menu-toggle  w-icon-hamburger"></a>
                        <a href="/" class="logo">
                            <img src="/images/logo.png" alt="logo" width="200">
                        </a>
                        <form class="input-wrapper header-search hs-expanded hs-round d-none d-md-flex" id="searchForm" style="position:relative;">
                            <div class="custom-search-bar w-100">
                                <input type="text" class="form-control" name="q" id="searchInput"
                                    placeholder="Search for products..." autocomplete="off" />
                                <button class="btn btn-search" type="submit" aria-label="Search">
                                    <i class="w-icon-search"></i>
                                </button>
                            </div>
                            <div id="searchSuggestions" class="search-suggestions"></div>
                        </form>
                        <div id="searchResults" class="search-results-container"></div>
                    </div>
                    <div class="header-right ml-4">
                        <div class="header-call d-xs-show d-lg-flex align-items-center">
                            <a href="tel:+919400947122" class="w-icon-call"></a>
                            <div class="call-info d-lg-show">
                                <h4 class="chat font-size-md text-normal ls-normal text-white mb-0">
                                    <a href="tel:+919400947122" class="text-capitalize text-primary font-weight-normal">Customer care</a>
                                </h4>
                                <a href="tel:+919400947122" class="phone-number font-weight-bolder ls-50">+91 9400947122</a>
                            </div>
                        </div>
                        <a class="wishlist label-down link d-xs-show" href="/wishlist">
                            <i class="w-icon-heart"></i>
                            <span class="wishlist-label d-lg-show">Wishlist</span>
                        </a>
                        <div class="dropdown cart-dropdown cart-offcanvas mr-0 mr-lg-2">
                            <div class="cart-overlay"></div>
                            <a href="/cart" class=" label-down link">
                                <i class="w-icon-cart">
                                    <span class="cart-count text-white">+</span>
                                </i>
                                <span class="cart-label">Cart</span>
                            </a>

                            <!-- End of Dropdown Box -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- End of Header Middle -->
        </header>
        <!-- End of Header -->


        <!-- Start of Main -->
        <main class="main">
            <!-- Start of Page Header -->
            <div class="page-header">
                <div class="container">
                    <h1 class="page-title mb-0">My Account</h1>
                </div>
            </div>
            <!-- End of Page Header -->

            <!-- Start of Breadcrumb -->
            <nav class="breadcrumb-nav">
                <div class="container">
                    <ul class="breadcrumb">
                        <li><a href="/">Home</a></li>
                        <li>My account</li>
                    </ul>
                </div>
            </nav>
            <!-- End of Breadcrumb -->

            <!-- Start of PageContent -->
            <div class="page-content pt-2">
                <div class="container">
                    <div class="tab tab-vertical row gutter-lg">
                        <ul class="nav nav-tabs mb-6" role="tablist">
                            <li class="nav-item">
                                <a href="#account-dashboard" class="nav-link active">Dashboard</a>
                            </li>
                            <li class="nav-item">
                                <a href="#account-orders" class="nav-link">Orders</a>
                            </li>

                            <li class="nav-item">
                                <a href="#account-addresses" class="nav-link">Addresses</a>
                            </li>

                            <li class="link-item">
                                <a href="/wishlist">Wishlist</a>
                            </li>
                            <li class="link-item">
                                <a href="/auth/logout">Logout</a>
                            </li>
                        </ul>

                        <div class="tab-content mb-6">
                            <div class="tab-pane active in" id="account-dashboard">
                                <div class="account-greeting card shadow-sm p-4 mb-4 bg-light rounded">
                                  <% if (user) { %>
                                    <div class="d-flex align-items-center mb-2">
                                      <img src="/images/prflepic.jpg" alt="Avatar" class="rounded-circle mr-3" style="width:48px;height:48px;object-fit:cover;">
                                      <div>
                                        <h4 class="mb-0">Welcome back, <span class="text-primary"><%= user.name %></span>!</h4>
                                        <small class="text-muted"><i class="w-icon-envelope"></i> <%= user.email %></small>
                                      </div>
                                    </div>
                                    <p class="mb-2">
                                      We're glad to see you again. From your account dashboard you can view your <a href="#account-orders" class="text-primary">recent orders</a>, manage your <a href="#account-addresses" class="text-primary">shipping addresses</a>, and update your <a href="/user/profile" class="text-primary">account details</a>.
                                    </p>
                                  <% } else { %>
                                    <div class="d-flex align-items-center mb-2">
                                      <img src="/images/prflepic.jpg" alt="Guest Avatar" class="rounded-circle mr-3" style="width:48px;height:48px;object-fit:cover;">
                                      <div>
                                        <h4 class="mb-0">Hello Guest ðŸ‘‹</h4>
                                        <small class="text-muted">You are not logged in.</small>
                                      </div>
                                    </div>
                                    <p class="mb-2">
                                      Please <a href="/auth/login" class="text-primary">log in</a> to access your account dashboard, view orders, and manage your wishlist.
                                    </p>
                                  <% } %>
                                </div>

                                <div class="row">
                                    <div class="col-lg-â‚¹ col-md-6 col-sm-â‚¹ col-xs-6 mb-â‚¹">
                                        <a href="#account-orders" class="link-to-tab">
                                            <div class="icon-box text-center">
                                                <span class="icon-box-icon icon-orders">
                                                    <i class="w-icon-orders"></i>
                                                </span>
                                                <div class="icon-box-content">
                                                    <p class="text-uppercase mb-0">Orders</p>
                                                </div>
                                            </div>
                                        </a>
                                    </div>

                                    <div class="col-lg-â‚¹ col-md-6 col-sm-â‚¹ col-xs-6 mb-â‚¹">
                                        <a href="#account-addresses" class="link-to-tab">
                                            <div class="icon-box text-center">
                                                <span class="icon-box-icon icon-address">
                                                    <i class="w-icon-map-marker"></i>
                                                </span>
                                                <div class="icon-box-content">
                                                    <p class="text-uppercase mb-0">Addresses</p>
                                                </div>
                                            </div>
                                        </a>
                                    </div>

                                    <div class="col-lg-â‚¹ col-md-6 col-sm-â‚¹ col-xs-6 mb-â‚¹">
                                        <a href="/wishlist" class="link-to-tab">
                                            <div class="icon-box text-center">
                                                <span class="icon-box-icon icon-wishlist">
                                                    <i class="w-icon-heart"></i>
                                                </span>
                                                <div class="icon-box-content">
                                                    <p class="text-uppercase mb-0">Wishlist</p>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="col-lg-â‚¹ col-md-6 col-sm-â‚¹ col-xs-6 mb-â‚¹">
                                        <a href="/auth/logout">
                                            <div class="icon-box text-center">
                                                <span class="icon-box-icon icon-logout">
                                                    <i class="w-icon-logout"></i>
                                                </span>
                                                <div class="icon-box-content">
                                                    <p class="text-uppercase mb-0">Logout</p>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane mb-â‚¹" id="account-orders">
                                <div class="icon-box icon-box-side icon-box-light">
                                    <span class="icon-box-icon icon-orders">
                                        <i class="w-icon-orders"></i>
                                    </span>
                                    <div class="icon-box-content">
                                        <hâ‚¹ class="icon-box-title text-capitalize ls-normal mb-0">Orders</hâ‚¹>
                                    </div>
                                </div>

                                <!-- Added wrapper divs for responsive scrolling -->
                                <div class="account-orders-scroll-container">
                                    <div class="account-orders-table-wrapper account-orders-responsive-wrapper">
                                        <table class="shop-table account-orders-table mb-6">
                                            <thead>
                                                <tr>
                                                    <th class="order-id">Order</th>
                                                    <th class="order-date">Date</th>
                                                    <th class="order-status">Status</th>
                                                    <th class="order-total">Total</th>
                                                    <th class="order-actions">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% if (orders && orders.length > 0) { %>
                                                    <% orders.forEach(function(order) { %>
                                                        <tr>
                                                            <td class="order-id">
                                                                #<%= order.orderId || order._id.toString().slice(-6).toUpperCase() %>
                                                            </td>
                                                            <td class="order-date">
                                                                <%= order.orderDate || (order.createdAt ? new Date(order.createdAt).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' }) : '') %>
                                                            </td>
                                                            <td class="order-status">
                                                                <%= order.orderStatus %>
                                                            </td>
                                                            <td class="order-total">
                                                                <span class="order-price">â‚¹<%= order.totalAmount ? order.totalAmount.toLocaleString('en-IN') : '0' %></span>
                                                                for
                                                                <span class="order-quantity">
                                                                    <%= order.items && order.items.length ? order.items.length : 0 %>
                                                                </span>
                                                                item<%= (order.items && order.items.length === 1) ? '' : 's' %>
                                                            </td>
                                                            <td class="order-action">
                                                                <a href="/orders"
                                                                    class="btn btn-outline btn-default ordr-btn btn-block btn-sm btn-rounded">View</a>
                                                            </td>
                                                        </tr>
                                                    <% }); %>
                                                <% } else { %>
                                                    <tr>
                                                        <td colspan="5" style="text-align:center; color:#888;">
                                                            No orders found.
                                                        </td>
                                                    </tr>
                                                <% } %>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <a href="/store" class="btn btn-dark btn-rounded btn-icon-right">Go
                                    Shop<i class="w-icon-long-arrow-right"></i></a>
                            </div>

                            <div id="account-addresses" class="tab-pane">
                                <div id="addressSection" class="row"></div>
                            </div>

                            <div class="modal-overlay" id="addressModalOverlay">
                                <div class="address-modal-container">
                                    <div class="modal-header-section">
                                        <h3 class="modal-title-text" id="modalTitle">Edit Address Details</h3>
                                        <button class="modal-close-btn" id="closeModalBtn">&times;</button>
                                    </div>

                                    <div class="form-content-area">
                                        <form class="address-edit-form" id="addressEditForm">
                                            <input type="hidden" id="addressId" />

                                            <div class="form-input-group">
                                                <label>Name</label>
                                                <input type="text" id="nameField" required />
                                            </div>
                                            <div class="form-input-group">
                                                <label>Phone</label>
                                                <input type="tel" id="phoneField" required />
                                            </div>
                                            <div class="form-input-group">
                                                <label>Pincode</label>
                                                <input type="text" id="pincodeField" required />
                                            </div>
                                            <div class="form-input-group">
                                                <label>State</label>
                                                <input type="text" id="stateField" required />
                                            </div>
                                            <div class="form-input-group">
                                                <label>City</label>
                                                <input type="text" id="cityField" required />
                                            </div>
                                            <div class="form-input-group">
                                                <label>District</label>
                                                <input type="text" id="districtField" />
                                            </div>
                                            <div class="form-input-group">
                                                <label>Address Line 1</label>
                                                <input type="text" id="addressLine1Field" required />
                                            </div>
                                            <div class="form-input-group">
                                                <label>Address Line 2</label>
                                                <input type="text" id="addressLine2Field" />
                                            </div>
                                            <div class="form-input-group">
                                                <label>Landmark</label>
                                                <input type="text" id="landmarkField" />
                                            </div>
                                            <div class="form-input-group">
                                                <label>Address Type</label>
                                                <select id="addressTypeField">
                                                    <option value="Home">Home</option>
                                                    <option value="Work">Work</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                            <div class="form-input-group">
                                                <label>
                                                    <input type="checkbox" id="isDefaultField" />
                                                    Set as default
                                                </label>
                                            </div>

                                            <div class="modal-action-buttons">
                                                <button type="button" id="cancelBtn">Cancel</button>
                                                <button type="submit">Save Changes</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane" id="account-details">
                                <div class="icon-box icon-box-side icon-box-light">
                                    <span class="icon-box-icon icon-account mr-2">
                                        <i class="w-icon-user"></i>
                                    </span>
                                    <div class="icon-box-content">
                                        <hâ‚¹ class="icon-box-title mb-0 ls-normal">Account Details</hâ‚¹>
                                    </div>
                                </div>
                                <form class="form account-details-form" action="#" method="post">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="firstname">First name *</label>
                                                <input type="text" id="firstname" name="firstname" placeholder="John"
                                                    class="form-control form-control-md">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="lastname">Last name *</label>
                                                <input type="text" id="lastname" name="lastname" placeholder="Doe"
                                                    class="form-control form-control-md">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group mb-3">
                                        <label for="display-name">Display name *</label>
                                        <input type="text" id="display-name" name="display_name" placeholder="John Doe"
                                            class="form-control form-control-md mb-0">
                                        <p>This will be how your name will be displayed in the account section and in
                                            reviews</p>
                                    </div>

                                    <div class="form-group mb-6">
                                        <label for="email_1">Email address *</label>
                                        <input type="email" id="email_1" name="email_1"
                                            class="form-control form-control-md">
                                    </div>

                                    <hâ‚¹ class="title title-password ls-25 font-weight-bold">Password change</hâ‚¹>
                                    <div class="form-group">
                                        <label class="text-dark" for="cur-password">Current Password leave blank to
                                            leave unchanged</label>
                                        <input type="password" class="form-control form-control-md" id="cur-password"
                                            name="cur_password">
                                    </div>
                                    <div class="form-group">
                                        <label class="text-dark" for="new-password">New Password leave blank to leave
                                            unchanged</label>
                                        <input type="password" class="form-control form-control-md" id="new-password"
                                            name="new_password">
                                    </div>
                                    <div class="form-group mb-10">
                                        <label class="text-dark" for="conf-password">Confirm Password</label>
                                        <input type="password" class="form-control form-control-md" id="conf-password"
                                            name="conf_password">
                                    </div>
                                    <button type="submit" class="btn btn-dark btn-rounded btn-sm mb-â‚¹">Save
                                        Changes</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const addressLinks = document.querySelectorAll('a[href="#account-addresses"]');

                    addressLinks.forEach(link => {
                        link.addEventListener("click", () => {
                            setTimeout(() => {
                                if (document.querySelector("#account-addresses").offsetParent !== null) {
                                    loadAddresses();
                                }
                            }, 100);
                        });
                    });
                });
            </script>
            <script>
                function showToast(message, type = "success") {
                    Toastify({
                        text: message,
                        duration: 3000,
                        gravity: "top",
                        position: "right",
                        backgroundColor: type === "success" ? "#28a745" : "#dc3545",
                        close: true
                    }).showToast();
                }
                const modalOverlay = document.getElementById("addressModalOverlay");
                const addressForm = document.getElementById("addressEditForm");
                const addressSection = document.getElementById("addressSection");

                document.getElementById("closeModalBtn").onclick = closeModal;
                document.getElementById("cancelBtn").onclick = closeModal;

                function closeModal() {
                    modalOverlay.style.display = "none";
                    addressForm.reset();
                    document.getElementById("addressId").value = "";
                }

                function openModal(title = 'Add Address') {
                    modalOverlay.style.display = "block";
                    document.getElementById("modalTitle").textContent = title;
                }

                function openAddAddressForm() {
                    addressForm.reset();
                    document.getElementById("addressId").value = "";
                    openModal("Add Address");
                }

                async function loadAddresses() {
                    try {
                        const res = await fetch("/address");
                        const addresses = await res.json();

                        if (!addresses.length) {
                            addressSection.innerHTML = `
                        <p>No address found. <button class="btn btn-primary" onclick="openAddAddressForm()">Add Address</button></p>
                      `;
                            return;
                        }

                        let html = addresses.map(address => `
                      <div class="col-sm-12 mb-4">
                        <div class="ecommerce-address billing-address pr-lg-8">
                          <h4>${address.addressType}${address.isDefault ? " (Default)" : ""}</h4>
                          <address>
                            <strong>${address.name}</strong><br/>
                            ${address.addressLine1}<br/>
                            ${address.addressLine2 ? address.addressLine2 + "<br/>" : ""}
                            ${address.landmark ? address.landmark + "<br/>" : ""}
                            ${address.city}, ${address.district || ""}, ${address.state}<br/>
                            ${address.pincode}<br/>
                            Phone: ${address.phone}
                          </address>
                          <button class="btn btn-sm btn-outline-primary" onclick='editAddress(${JSON.stringify(address)})'>Edit</button>
                          <button class="btn btn-sm btn-outline-danger" onclick="deleteAddress('${address._id}')">Delete</button>
                        </div>
                      </div>
                    `).join('');

                        if (addresses.length < 5) {
                            html += `<div class="col-sm-12"><button class="btn btn-primary" onclick="openAddAddressForm()">Add New Address</button></div>`;
                        }

                        addressSection.innerHTML = html;
                    } catch (err) {
                        console.error("Error loading addresses", err);
                        addressSection.innerHTML = `<p>Error loading addresses.</p>`;
                    }
                }

                function editAddress(data) {
                    for (const key in data) {
                        const field = document.getElementById(key + "Field");
                        if (field) field.value = data[key];
                    }
                    document.getElementById("addressId").value = data._id;
                    document.getElementById("isDefaultField").checked = !!data.isDefault;
                    openModal("Edit Address");
                }

                async function deleteAddress(id) {
                    if (!confirm("Are you sure you want to delete this address?")) return;
                    try {
                        const res = await fetch(`/delete-address/${id}`, { method: "DELETE" });
                        const result = await res.json();
                        showToast(result.message || "Address deleted successfully");
                        loadAddresses();
                    } catch (err) {
                        showToast("Error deleting address.", "error");
                    }
                }

                addressForm.addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const id = document.getElementById("addressId").value;

                    const data = {
                        name: document.getElementById("nameField").value,
                        phone: document.getElementById("phoneField").value,
                        pincode: document.getElementById("pincodeField").value,
                        state: document.getElementById("stateField").value,
                        city: document.getElementById("cityField").value,
                        district: document.getElementById("districtField").value,
                        addressLine1: document.getElementById("addressLine1Field").value,
                        addressLine2: document.getElementById("addressLine2Field").value,
                        landmark: document.getElementById("landmarkField").value,
                        addressType: document.getElementById("addressTypeField").value,
                        isDefault: document.getElementById("isDefaultField").checked
                    };

                    try {
                        if (id) {
                            await fetch(`/edit-address/${id}`, {
                                method: "PUT",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify(data)
                            });
                            showToast("Address updated successfully");
                        } else {
                            await fetch("/create-address", {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify(data)
                            });
                            showToast("Address created successfully");
                        }

                        closeModal();
                        loadAddresses();
                    } catch (err) {
                        console.error("Failed to save address", err);
                        showToast("Failed to save address", "error");
                    }
                });

                loadAddresses(); // Call on page load
            </script>

            <!-- End of PageContent -->
        </main>
        <!-- End of Main -->
 
        <!-- Start of Footer -->
        <footer class="footer appear-animate" data-animation-options="{
            'name': 'fadeIn'
        }">
            <div class="footer-newsletter bg-primary">
                <div class="container">
                    <div class="row justify-content-center align-items-center">
                        <div class="col-xl-5 col-lg-6">
                            <div class="icon-box icon-box-side text-white">
                                <div class="icon-box-icon d-inline-flex">
                                    <i class="w-icon-envelop3"></i>
                                </div>
                                <div class="icon-box-content">
                                    <h4 class="icon-box-title text-white text-uppercase font-weight-bold">Subscribe To
                                        Our Newsletter</h4>
                                    <p class="text-white">Get all the latest information on Events, Sales and Offers.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-7 col-lg-6 col-md-9 mt-4 mt-lg-0 ">
                            <form action="#" method="get"
                                class="input-wrapper input-wrapper-inline input-wrapper-rounded">
                                <input type="email" class="form-control mr-2 bg-white" name="email" id="email"
                                    placeholder="Your E-mail Address" />
                                <button class="btn btn-dark btn-rounded" type="submit">Subscribe<i
                                        class="w-icon-long-arrow-right"></i></button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="footer-top">
                    <div class="row">
                        <div class="col-lg-4 col-sm-6">
                            <div class="widget widget-about mt-0 mb-4">
                                <a href="/" class="logo-footer">
                                    <img src="/images/logo.png" alt="logo-footer" width="200" height="45" />
                                </a>
                                <div class="widget-body">
                                    <p class="widget-about-title">Got Question? Call us 24/7</p>
                                    <a href="tel:+919400947122" class="widget-about-call">+91 9400947122</a>
                                     <p>Follow Us In :</p>
                                   <div class="social-icons social-icons-colored">
                                        <a    target="_blank"  href="https://www.facebook.com/profile.php?id=61577041363849#"
                                            class="social-icon social-facebook w-icon-facebook"></a>
                                        <a    target="_blank"  href="https://www.instagram.com/hofmaan.official/?fbclid=IwY2xjawLJwfRleHRuA2FlbQIxMQBicmlkETFtbmQ0UnlRc3gyNDAwaU44AR5ZqTiWzEixcnjCAnjWdJJKxyOo1SDmgvhwN8_53T5gbWCz_nWAy3l3UTZALw_aem_icwl_UgQrgnfthtQ81Mmyw"
                                            class="social-icon social-instagram w-icon-instagram"></a>
                                        <a    target="_blank"  href="https://www.youtube.com/@hofmaanofficial"
                                            class="social-icon social-youtube w-icon-youtube"></a>
                                                <a    target="_blank"  href="https://in.pinterest.com/hofmaan_official/"
                                            class="social-icon social-pinterest w-icon-pinterest"></a>
                            <a href="https://www.linkedin.com/company/107658144/admin/page-posts/published/" 
   class="social-icon" 
   target="_blank" 
   rel="noopener noreferrer">
   <i style="color: blue;" class="fab fa-linkedin-in"></i> 
</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-sm-6">
                            <div class="widget">
                                <h3 class="widget-title">Company</h3>
                                <ul class="widget-body">
                                        <li><a href="/">Home</a></li>
                                        <li><a href="/store">Store</a></li>
                                    <li><a href="/about">About Us</a></li>
                                    <li><a href="/blogs">Blogs</a></li>
                                    <li><a href="/contact">Contact Us</a></li>                              
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-3 col-sm-6">
                            <div class="widget">
                                <h4 class="widget-title">My Account</h4>
                                <ul class="widget-body">
                                    <li><a href="/orders">Track My Order</a></li>
                                    <li><a href="/cart">View Cart</a></li>
                                    <% if (user) { %>
                                        <li><a href="/account">Account</a></li>
                                        <% } else { %>
                                            <li><a href="/auth/login">Sign In</a></li>
                                            <% } %>
                                    <li><a href="/wishlist">My Wishlist</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-3 col-sm-6">
                            <div class="widget">
                                <h4 class="widget-title">Customer Service</h4>
                                <ul class="widget-body">
                                    <li><a href="/terms_and_conditions">Terms and Conditions</a></li>
                                    <li><a href="/Cancellation_Refund">Cancellation Refund</a></li>
                                    <li><a href="/shipping_policy">Shipping Policy</a></li>
                                    <li><a href="/privacy_policy">Privacy Policy</a></li>
                           
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="footer-bottom">
                    <div class="footer-left">
                        <p class="copyright">
                            Copyright Â© 2025 Hofmaan. All Rights Reserved. &nbsp;|&nbsp;
                            developed by <a href="https://trivlogic.com/" target="_blank" rel="noopener" style="color:#888;text-decoration:none;">Trivlogic Pvt Ltd</a>
                        </p>
                    </div>
                    <div class="footer-right">
                        <span class="payment-label mr-lg-8">We're using safe payment for</span>
                        <figure class="payment">
                            <img src="/images/payment.png" alt="payment" width="159" height="25" />
                        </figure>
                    </div>
                </div>
            </div>
        </footer>
        <!-- End of Footer -->
    </div>
    <!-- End of Page Wrapper -->

    <!-- Start of Sticky Footer -->
    <div class="btm-main">
        <a href="#" id="mobileSearchRedirect" class="search-bar-link">
            <div class="search-bar" id="searchBar">
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search search-input-icon"></i>
                        <input type="text" class="search-input" placeholder="Search products..." id="mobileSearchInput">
                    </div>
                    <button class="search-btn" id="mobileSearchButton">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </a>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const input = document.getElementById('mobileSearchInput');
                const btn = document.getElementById('mobileSearchButton');
                const link = document.getElementById('mobileSearchRedirect');
                function doSearch(e) {
                    e.preventDefault();
                    const q = input.value.trim();
                    if (q.length > 0) {
                        window.location.href = '/store?q=' + encodeURIComponent(q);
                    }
                }
                btn.addEventListener('click', doSearch);
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        doSearch(e);
                    }
                });
                link.addEventListener('click', function(e) {
                    // Prevent default link if not searching
                    if (input.value.trim().length === 0) e.preventDefault();
                });
            });
        </script>

        <nav class="mobile-bottom-nav">

            <div class="mob-btm-nav">
                <a href="/cart" class="sticky-link1">
                    <i class="fas fa-shopping-cart"></i>
                    <p>Cart</p>
                </a>
            </div>

            <div class="mob-btm-nav">
                <a href="/orders" class="sticky-link1">
                    <i class="fas fa-clipboard-list"></i>
                    <p>Orders</p>
                </a>
            </div>

            <div class="mob-btm-nav">
                <a href="#0" id="searchBtn" class="sticky-link1">
                    <i class="fas fa-search"></i>
                    <p>Search</p>
                </a>
            </div>

            <div class="mob-btm-nav">
                <a href="/wishlist" class="sticky-link1">
                    <i class="fas fa-heart"></i>
                    <p>Wishlist</p>
                </a>
            </div>
        </nav>
    </div>

    <div class="sticky-footer sticky-content fix-bottom">

        <a href="/" class="sticky-link  ">
            <i class="w-icon-home"></i>
            <p>Home</p>
        </a>
        <a href="/store" class="sticky-link">
            <i class="w-icon-products"></i>
            <p>Store</p>
        </a>
        <a class="btm-img" href="/"> <img src="/images/logo-2.png" alt=""></a>
        <% if (user) { %>
            <a href="/account" class="sticky-link active-mob">
                <i class="w-icon-account"></i>
                <p>Account</p>
            </a>
            <% } else { %>
                <a href="/auth/login" class="sticky-link">
                    <i class="w-icon-account"></i>
                    <p>Login</p>
                </a>
                <% } %>


                    <a href="/contact" class="sticky-link">
                        <i class="w-icon-call2"></i>
                        <p>Contact </p>
                    </a>
    </div>
    <!-- End of Sticky Footer -->

    <!-- Start of Scroll Top -->
    <a id="scroll-top" class="scroll-top" href="#top" title="Top" role="button"> <i class="w-icon-angle-up"></i> <svg
            version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 70">
            <circle id="progress-indicator" fill="transparent" stroke="#000000" stroke-miterlimit="10" cx="35" cy="35"
                r="3â‚¹" style="stroke-dasharray: 16.â‚¹198, â‚¹00;"></circle>
        </svg> </a>
    <!-- End of Scroll Top -->

    <!-- Start of Mobile Menu -->
    <div class="mobile-menu-wrapper">
        <div class="mobile-menu-overlay"></div>
        <!-- End of .mobile-menu-overlay -->

        <a href="#" class="mobile-menu-close"><i class="close-icon"></i></a>
        <!-- End of .mobile-menu-close -->

        <div class="mobile-menu-container scrollable">
            <img class="side-logo" src="/images/logo.png" alt="logo">
            <!-- End of Search Form -->
            <div class="tab">
                <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item">
                        <a href="#main-menu" class="nav-link active">Main Menu</a>
                    </li>
                    <li class="nav-item">
                        <a href="#categories" class="nav-link">Categories</a>
                    </li>
                </ul>
            </div>
            <div class="tab-content">
                <div class="tab-pane active" id="main-menu">
                    <ul class="mobile-menu">
                        <li><a href="/">Home</a></li>
                        <li><a href="/store">Store</a></li>
                        <% if (user) { %>
                        <li><a href="/account">Profile</a></li>
                        <% } else { %>
                        <li><a href="/auth/login">Login</a></li>
                        <% } %>
                        <li><a href="/wishlist">Wishlist</a></li>
                        <li><a href="/cart">Cart</a></li>
                        <li><a href="/about">About Us</a></li>
                        <li><a href="/blogs">Blogs</a></li>
                        <li><a href="/contact">Contact Us</a></li>

                    </ul>
                </div>
                <div class="tab-pane" id="categories">
                    <ul class="mobile-menu">
                        <% categories.forEach(category=> { %>
                            <li>
                                <a style="gap: 10px!important; display: flex;" href="/store?category=<%= category._id %>">
                                    <img style="height: 30px; width: 30px; border-radius: 50px;"
                                        src="<%= category.imageUrl || '/images/hofmaan/sample3.jpg' %>" alt="">
                                    <%= category.name %>
                                </a>
                                <% if (category.subCategories && category.subCategories.length> 0) { %>
                                    <ul>
                                        <% category.subCategories.forEach(sub=> { %>
                                            <% if (sub.isActive) { %>
                                                <li>
                                                    <a href="/store?subcategory=<%= sub._id %>">
                                                        <%= sub.name %>
                                                    </a>
                                                </li>
                                                <% } %>
                                                    <% }); %>
                                    </ul>
                                    <% } %>
                            </li>
                            <% }); %>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- End of Mobile Menu -->
  <!--whats app icon -->
<div class="whatsapp-float">
  <a href="https://wa.me/+919400947122" target="_blank" rel="noopener noreferrer">
    <i class="fab fa-whatsapp whatsapp-icon"></i>
  </a>
</div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchInput = document.getElementById('searchInput');
            const searchForm = document.getElementById('searchForm');
            const suggestionsContainer = document.getElementById('searchSuggestions');
            const resultsContainer = document.getElementById('searchResults');
            let searchTimeout;

            // Helper to safely format price
            function formatPrice(price) {
                if (typeof price === 'number' && !isNaN(price)) {
                    return price.toLocaleString('en-IN');
                }
                if (typeof price === 'string' && price.trim() !== '' && !isNaN(Number(price))) {
                    return Number(price).toLocaleString('en-IN');
                }
                return '';
            }

            // Search input handler
            searchInput.addEventListener('input', function (e) {
                clearTimeout(searchTimeout);
                const query = e.target.value.trim();

                if (query.length < 2) {
                    suggestionsContainer.style.display = 'none';
                    return;
                }

                searchTimeout = setTimeout(() => {
                    fetchSuggestions(query);
                }, 300);
            });

            // Form submission handler
            searchForm.addEventListener('submit', function (e) {
                e.preventDefault();
                const query = searchInput.value.trim();
                if (query) {
                    performSearch(query);
                }
            });

            // Close results when clicking outside
            document.addEventListener('click', function (e) {
                if (!searchForm.contains(e.target)) {
                    suggestionsContainer.style.display = 'none';
                    resultsContainer.style.display = 'none';
                }
            });

            // Fetch search suggestions
            async function fetchSuggestions(query) {
                try {
                    const response = await fetch(`/search/suggestions?q=${encodeURIComponent(query)}`);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const suggestions = await response.json();

                    if (!Array.isArray(suggestions)) {
                        throw new Error('Invalid suggestions format');
                    }

                    displaySuggestions(suggestions);
                } catch (error) {
                    console.error('Error fetching suggestions:', error);
                    suggestionsContainer.style.display = 'none';
                    suggestionsContainer.innerHTML = '<div class="error-message">Failed to load suggestions</div>';
                }
            }

            // Display suggestions
            function displaySuggestions(suggestions) {
                if (!suggestions || suggestions.length === 0) {
                    suggestionsContainer.innerHTML = '<div class="no-suggestions">No suggestions found</div>';
                    suggestionsContainer.style.display = 'block';
                    return;
                }

                suggestionsContainer.innerHTML = '';
                suggestions.forEach(item => {
                    const suggestionItem = document.createElement('div');
                    suggestionItem.className = 'suggestion-item';
                    suggestionItem.innerHTML = `
            ${item.images?.length ? `<img src="${item.images[0]}" alt="${item.name}" />` : ''}
            <div class="suggestion-text">
                <div class="suggestion-name">${item.name}</div>
                <div class="suggestion-price">â‚¹${formatPrice(item.basePrice)}</div>
            </div>
        `;
                    // âœ… Navigate to product page directly
                    suggestionItem.addEventListener('click', () => {
                        window.location.href = `/product/${item._id}`;
                    });
                    suggestionsContainer.appendChild(suggestionItem);
                });
                suggestionsContainer.style.display = 'block';
            }

            // Perform full search
            async function performSearch(query) {
                try {
                    const response = await fetch(`/search?q=${encodeURIComponent(query)}`);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const results = await response.json();

                    if (!Array.isArray(results)) {
                        throw new Error('Invalid results format');
                    }

                    displaySearchResults(query, results);
                } catch (error) {
                    console.error('Error performing search:', error);
                    displaySearchResults(query, []);
                }
            }

            // Display search results
            function displaySearchResults(query, products) {
                suggestionsContainer.style.display = 'none';

                if (!products || products.length === 0) {
                    resultsContainer.innerHTML = `
                <div class="no-results">
                    <h3>No results found for "${query}"</h3>
                    <p>Try different keywords or browse our categories</p>
                </div>
            `;
                } else {
                    resultsContainer.innerHTML = `
                <div class="search-results-header">
                    <h3>Results for "${query}" (${products.length})</h3>
                    <span class="close-results">&times;</span>
                </div>
                <div class="search-results-grid">
                    ${products.map(product => {
                        const priceStr = formatPrice(product.basePrice);
                        return `
                        <div class="search-result-item">
                            <a href="/product/${product._id}">
                                <img src="${product.images?.[0] || '/images/placeholder.jpg'}" alt="${product.name}" />
                                <div class="item-details">
                                    <h4>${product.name}</h4>
                                <div class="item-price">â‚¹${formatPrice(product.salePrice || product.basePrice)}</div>
                                    ${product.description ? `<p class="item-desc">${product.description.substring(0, 60)}...</p>` : ''}
                                </div>
                            </a>
                        </div>
                        `;
                    }).join('')}
                </div>
            `;
                }

                // Show results container
                resultsContainer.style.display = 'block';

                // Close button handler
                const closeBtn = resultsContainer.querySelector('.close-results');
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        resultsContainer.style.display = 'none';
                    });
                }
            }
        });
    </script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="/vendor/jquery/jquery.min.js"></script>
    <script src="/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="/vendor/magnific-popup/jquery.magnific-popup.min.js"></script>
    <script src="/js/main.min.js"></script>
    <script src="/js/script.js"></script>
</body>



</html>